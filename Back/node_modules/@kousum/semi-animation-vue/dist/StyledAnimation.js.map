{"version":3,"file":"StyledAnimation.js","sources":["../src/animation/StyledAnimation.tsx"],"sourcesContent":["import {\n  defineComponent,\n  ref,\n  h,\n  onActivated,\n  Fragment,\n  StyleValue,\n  isVNode,\n  cloneVNode,\n  CSSProperties,\n  ComponentObjectPropsOptions, PropType\n} from 'vue'\n\nimport classnames from 'classnames';\nimport {types as styledTypes, loops, delays, speeds} from '@douyinfe/semi-animation-styled';\nimport noop from './utils/noop';\nimport invokeFns from './utils/invokeFns';\n\nexport interface StyledAnimationProps {\n  state?:any\n  willEnter?:any\n  didEnter?:any\n  willLeave?:any\n  didLeave?:any\n  from?:any\n  motion?:any\n  name?:any\n  position?:any\n\n\n  className?: string;\n  type?: any;\n  style?: CSSProperties;\n  speed?: string | number;\n  delay?: string | number;\n  reverse?: boolean | string;\n  loop?: string | number;\n  onStart?: (value: any) => void;\n  onFrame?: (value: any) => void;\n  onRest?: (value: any) => void;\n  prefixCls?: string;\n  timing?: string;\n  duration?: string | number;\n  fillMode?: string;\n  transitionState?: string,\n}\n\nexport interface StyledAnimateStyleType {\n  animationTimingFunction: string;\n  animationName: any;\n  animationDuration: string | number;\n  animationDelay: string | number;\n  animationIterationCount: string | number;\n  animationDirection: string;\n  animationFillMode: string;\n}\n\nconst types: any = Object.values(styledTypes).reduce((arr, cur) => [...arr as any, ...cur as any], []);\n\n\nexport const vuePropsType: ComponentObjectPropsOptions<StyledAnimationProps> = {\n  state: [Object, String, Boolean, Function] as PropType<StyledAnimationProps['state']>,\n  willEnter: [Object, String, Boolean, Function] as PropType<StyledAnimationProps['willEnter']>,\n  didEnter: [Object, String, Boolean, Function] as PropType<StyledAnimationProps['didEnter']>,\n  willLeave: [Object, String, Boolean, Function] as PropType<StyledAnimationProps['willLeave']>,\n  didLeave: [Object, String, Boolean, Function] as PropType<StyledAnimationProps['didLeave']>,\n  from: [Object, String, Boolean, Function] as PropType<StyledAnimationProps['from']>,\n  motion: [Object, String, Boolean, Function] as PropType<StyledAnimationProps['motion']>,\n  name: [Object, String, Boolean, Function] as PropType<StyledAnimationProps['name']>,\n  position: [Object, String, Boolean, Function] as PropType<StyledAnimationProps['position']>,\n  transitionState: String,\n\n  className: String,\n  type: [Object, String],\n  style: [Object, String] as PropType<StyledAnimationProps['style']>,\n  speed: {\n    type: [Number, String], default: 'faster'\n  },\n  delay: [Number, String],\n  reverse: [Number, String] as PropType<StyledAnimationProps['reverse']>,\n  loop: [Number, String],\n  onStart: {type: Function as PropType<StyledAnimationProps['onStart']>, default: noop},\n  onFrame: {type: Function as PropType<StyledAnimationProps['onFrame']>, default: noop},\n  onRest: {type: Function as PropType<StyledAnimationProps['onRest']>, default: noop},\n  prefixCls: {type: String, default: 'semi'},\n  timing: String,\n  duration: [Number, String],\n  fillMode: String,\n}\nconst StyledAnimation = defineComponent<StyledAnimationProps>(\n  (props, {slots}) => {\n  // 在keep-alive = true时  相当于 onShow\n  onActivated(() => {\n\n  })\n  const _generateAnimateEvents = (child: any, props: StyledAnimationProps = {}) => (\n    {\n      onAnimationiteration: (...args: any) =>\n        invokeFns([child && child.props && child.props.onAnimationiteration, props.onFrame], args),\n      onAnimationstart: (...args: any) =>\n        invokeFns([child && child.props && child.props.onAnimationstart, props.onStart], args),\n      onAnimationend: (...args: any) => {\n        // console.error(props.onRest)\n\n        return invokeFns([child && child.props && child.props.onAnimationend, props.onRest], args)\n      },\n    }\n  );\n\n  const _hasSpeedClass = (speed = props.speed) => speed != null && speeds.includes(speed as string);\n  const _hasTypeClass = (type = props.type) => type != null && types.includes(type);\n  const _hasDelayClass = (delay = props.delay) => delay != null && delays.includes(delay as string);\n  const _hasLoopClass = (loop = props.loop) => loop != null && loops.includes(loop as string);\n\n\n  return () => {\n\n    let {\n      type,\n      speed,\n      duration,\n      delay,\n      loop,\n      reverse,\n      prefixCls,\n      timing,\n      className,\n      fillMode,\n    } = props;\n\n    const hasTypeClass = _hasTypeClass();\n    const hasSpeedClass = _hasSpeedClass();\n    const hasDelayClass = _hasDelayClass();\n    const hasLoopClass = _hasLoopClass();\n\n    const animateCls =\n      className ||\n      classnames(`${prefixCls}-animated`, {\n        [`${prefixCls}-${type}`]: Boolean(type), // How to use it before compatibility\n        [`${prefixCls}-speed-${speed}`]: hasSpeedClass,\n        [`${prefixCls}-delay-${delay}`]: hasDelayClass,\n        [`${prefixCls}-loop-${loop}`]: hasLoopClass,\n      });\n\n    const animateStyle = {\n      animationTimingFunction: timing,\n      animationName: !hasTypeClass && type,\n      animationDuration: duration,\n      animationDelay: !hasDelayClass && delay,\n      animationIterationCount: !hasLoopClass && loop,\n      animationDirection: reverse ? 'alternate' : 'normal',\n      animationFillMode: fillMode,\n    };\n    return slots.default ? slots.default({\n      animateCls,\n      animateStyle,\n      animateEvents: _generateAnimateEvents(null, props)\n    }) : null\n  }\n\n\n  //\n  // return () => {\n  //   if (slots.default && isVNode(slots.default)) {\n  //     return slots.default().map(slots.default, (child: any) => {\n  //       const animateEvents = _generateAnimateEvents(child, props);\n  //       let style = props.style ? props.style : {}\n  //       return (cloneVNode(child, {\n  //           className: classnames(child.props.class, animateCls),\n  //           style: {...child.props.style, ...style},\n  //           ...animateEvents,\n  //         })\n  //       );\n  //     });\n  //   } else {\n  //     return slots.default({animateCls, animateStyle, animateEvents: _generateAnimateEvents(null, props)})\n  //   }\n  // };\n},{\n    props: vuePropsType,\n    name: 'StyledAnimation'\n  }\n)\n\n\nexport default StyledAnimation\n\n\n\n"],"names":["types","Object","values","styledTypes","reduce","arr","cur","vuePropsType","state","String","Boolean","Function","willEnter","didEnter","willLeave","didLeave","from","motion","name","position","transitionState","className","type","style","speed","Number","default","delay","reverse","loop","onStart","noop","onFrame","onRest","prefixCls","timing","duration","fillMode","StyledAnimation","defineComponent","props","slots","onActivated","_generateAnimateEvents","child","onAnimationiteration","args","invokeFns","onAnimationstart","onAnimationend","_hasSpeedClass","speeds","includes","_hasTypeClass","_hasDelayClass","delays","_hasLoopClass","loops","hasTypeClass","hasSpeedClass","hasDelayClass","hasLoopClass","animateCls","classnames","animateStyle","animationTimingFunction","animationName","animationDuration","animationDelay","animationIterationCount","animationDirection","animationFillMode","animateEvents"],"mappings":"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"}