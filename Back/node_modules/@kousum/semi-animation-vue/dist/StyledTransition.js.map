{"version":3,"file":"StyledTransition.js","sources":["../src/animation/StyledTransition.tsx"],"sourcesContent":["import {\n  defineComponent,\n  ref,\n  h,\n  onActivated,\n  Fragment,\n  onMounted,\n  watch,\n  ComponentObjectPropsOptions,\n  PropType\n} from 'vue'\n\nimport StyledAnimation, {StyledAnimationProps} from './StyledAnimation';\nimport noop from './utils/noop';\n\nexport interface StyledTransitionProps extends StyledAnimationProps {\n  state?: string | boolean;\n  enter?: string;\n  leave?: string;\n  transitionState:string\n  willEnter?: (value: any) => void;\n  didEnter?: (value: any) => void;\n  willLeave?: (value: any) => void;\n  didLeave?: (value: any) => void;\n  onStart?: (value: any) => void;\n  onRest?: (value: any) => void;\n}\n\nexport const vuePropsType:ComponentObjectPropsOptions<StyledTransitionProps> = {\n  duration: String,\n  className: String,\n  name: String,\n  position: String,\n  motion: [Object, String, Boolean, Function],\n  transitionState: String,\n\n  state: {\n    type: [String, Boolean],\n    default: undefined as any\n  },\n  from: Object,\n  enter: String,\n  leave: String,\n\n  willEnter: {\n    type: Function as PropType<StyledTransitionProps['willEnter']>,\n    default: noop,\n  },\n  didEnter: {\n    type: Function as PropType<StyledTransitionProps['didEnter']>,\n    default: noop,\n  },\n  willLeave: {\n    type: Function as PropType<StyledTransitionProps['willLeave']>,\n    default: noop,\n  },\n  didLeave: {\n    type: Function as PropType<StyledTransitionProps['didLeave']>,\n    default: noop,\n  },\n  onRest: {\n    type: Function as PropType<StyledTransitionProps['onRest']>,\n    default: noop,\n  },\n  onStart: {\n    type: Function as PropType<StyledTransitionProps['onStart']>,\n    default: noop,\n  },\n}\n\nexport interface StyledTransitionState {\n  state: string | boolean;\n  lastChildren: any;\n  currentChildren: any;\n}\n\n\nconst StyledTransition = defineComponent<StyledTransitionProps>((props, {slots}) => {\n\n\n  let instance: any;\n  const state = ref<string | boolean>('')\n  const lastChildren = ref(null)\n  const currentChildren = ref(null)\n\n  onMounted(() => {\n\n    if (instance) {\n      instance.destroy();\n      instance = null;\n    }\n  })\n\n\n\n  // TODO getDerivedStateFromProps\n  // onMounted(()=>{\n  //   if (slots.default !== currentChildren.value) {\n  //     lastChildren.value = currentChildren.value;\n  //     currentChildren.value = slots.default;\n  //\n  //\n  //     if (slots.default == null) {\n  //       state.value = 'leave';\n  //     } else {\n  //       state.value = 'enter';\n  //     }\n  //   }\n  // })\n\n  // TODO getDerivedStateFromProps\n  watch([()=>props.transitionState, currentChildren,lastChildren], (newData, preData)=>{\n    // console.log(props, state);\n    // console.error(newData, preData)\n    if (slots.default !== currentChildren.value) {\n      lastChildren.value = currentChildren.value;\n      currentChildren.value = slots.default;\n\n      state.value = props.transitionState;\n\n    }\n    // console.log(state.value)\n  }, {immediate: true})\n\n\n  watch(()=>props.state , ()=>{\n    if (props.state != null) {\n      state.value = props.state;\n    }\n  })\n\n\n\n  const _isControlled = () => [true, false, 'enter', 'leave'].includes(props.state);\n\n  const forwardInstance = (instance0: any) => {\n    instance = instance0;\n  };\n\n  const onRest = (thisProps: any) => {\n    // console.log(state.value )\n\n    if (state.value === 'enter') {\n      props.didEnter(thisProps);\n    } else if (state.value === 'leave') {\n      currentChildren.value = null\n      lastChildren.value = null\n      props.didLeave(thisProps);\n    }\n\n    props.onRest(thisProps);\n  };\n\n  const onStart = (thisProps: any) => {\n\n    if (state.value === 'enter') {\n      props.willEnter(thisProps);\n    } else if (state.value === 'leave') {\n      props.willLeave(thisProps);\n    }\n\n    props.onStart(thisProps);\n  };\n\n\n  return ()=>{\n\n    const { enter, leave, ...restProps } = props;\n\n    const isControlled = _isControlled();\n\n\n    let children:any, type: string;\n\n    let thisSate:any = JSON.parse(JSON.stringify(state.value));\n\n\n    if (isControlled) {\n      children = slots.default;\n      thisSate = props.state;\n    } else if (currentChildren == null && lastChildren == null) {\n      return null;\n    }\n\n    if (thisSate === 'enter') {\n      type = enter;\n\n      if (!isControlled) {\n        children = currentChildren.value;\n      }\n    } else if (thisSate === 'leave') {\n      type = leave;\n\n      if (!isControlled) {\n        children = lastChildren.value;\n      }\n    }\n\n    const props_ =  {...{...restProps,type,onStart,onRest}}\n    // console.log(thisSate,type)\n    return (\n      <StyledAnimation {...{...restProps,type,onStart,onRest}}>\n        {{\n          default: typeof children === 'function'?(arg:any)=>children(arg):\n            // @ts-ignore\n            ()=>null\n        }}\n      </StyledAnimation>\n    )\n  };\n}, {\n  props: vuePropsType,\n  name: 'StyledTransition'\n})\n\n\nexport default StyledTransition\n\n"],"names":["vuePropsType","duration","String","className","name","position","motion","Object","Boolean","Function","transitionState","state","type","default","undefined","from","enter","leave","willEnter","noop","didEnter","willLeave","didLeave","onRest","onStart","StyledTransition","defineComponent","props","slots","ref","lastChildren","currentChildren","onMounted","watch","newData","preData","value","immediate","_isControlled","includes","thisProps","restProps","isControlled","children","thisSate","JSON","parse","stringify","_createVNode","StyledAnimation","arg"],"mappings":"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"}