{"version":3,"file":"index.js","sources":["../../src/components/tag/index.tsx"],"sourcesContent":["  import {\n  defineComponent,\n  ref,\n  h,\n  Fragment,\n  VNode,\n  CSSProperties,\n  reactive,\n  watch,\n  PropType,\n  HTMLAttributes,\n} from 'vue';\nimport * as PropTypes from '../PropTypes';\nimport classNames from 'classnames';\nimport { cssClasses, strings } from '@douyinfe/semi-foundation/tag/constants';\nimport Avatar from '../avatar';\nimport { IconClose } from '@kousum/semi-icons-vue';\nimport { TagProps, TagSize, TagColor, TagType, AvatarShape, TagShape } from './interface';\nimport { handlePrevent } from '@douyinfe/semi-foundation/utils/a11y';\nimport '@douyinfe/semi-foundation/tag/tag.scss';\nimport { CombineProps, VueJsxNode } from '../interface';\nimport { symbol, vuePropsMake } from '../PropTypes';\nimport { isString } from 'lodash';\nimport cls from 'classnames';\nimport { ComponentObjectPropsOptions } from 'vue';\nimport { useHasInProps } from '../_base/baseComponent';\n\nexport * from './interface';\n\nconst prefixCls = cssClasses.PREFIX;\n\nconst tagColors = strings.TAG_COLOR;\n\nconst tagSize = strings.TAG_SIZE;\nconst tagType = strings.TAG_TYPE;\nconst avatarShapeSet = strings.AVATAR_SHAPE;\n\nexport interface TagState {\n  visible: boolean;\n}\n\nconst propTypes: CombineProps<TagProps> = {\n  tagKey: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  size: String as PropType<TagProps['size']>,\n  color: String as PropType<TagProps['color']>,\n  type: String as PropType<TagProps['type']>,\n  closable: PropTypes.bool,\n  visible: PropTypes.bool,\n  onClose: PropTypes.func as PropType<TagProps['onClose']>,\n  onClick: PropTypes.func as PropType<TagProps['onClick']>,\n  style: PropTypes.object,\n  className: PropTypes.string,\n  avatarSrc: PropTypes.string,\n  avatarShape: String as PropType<TagProps['avatarShape']>,\n  'aria-label': PropTypes.string,\n\n  shape: { type: String as PropType<TagProps['shape']>, default: 'square' },\n  onKeydown: Function as PropType<TagProps['onKeydown']>,\n  tabIndex: Number, // use internal, when tag in taInput, we want to use left arrow and right arrow to control the tag focus, so the tabIndex need to be -1.\n  onMouseenter: [Function, Array] as PropType<TagProps['onMouseenter']>,\n  prefixIcon: PropTypes.node as PropType<TagProps['prefixIcon']>,\n  suffixIcon: PropTypes.node as PropType<TagProps['suffixIcon']>,\n};\nconst defaultProps: TagProps = {\n  size: tagSize[0] as TagSize,\n  color: tagColors[0] as TagColor,\n  closable: false,\n  // visible: true,\n  type: tagType[0] as TagType,\n  onClose: () => undefined,\n  onClick: () => undefined,\n  onMouseenter: () => undefined,\n  style: {},\n  className: '',\n  shape: 'square',\n  avatarShape: 'square',\n  prefixIcon: null,\n  suffixIcon: null,\n};\nexport const vuePropsType = vuePropsMake<TagProps>(propTypes, defaultProps);\nconst Index = defineComponent({\n  props: { ...vuePropsType },\n  name: 'Tag',\n  setup(props, { slots }) {\n    const {getProps} = useHasInProps()\n    const state = reactive<TagState>({\n      visible: true,\n    });\n    // ok\n    function getDerivedStateFromProps(nextProps: TagProps) {\n      if ('visible' in nextProps) {\n        return {\n          visible: nextProps.visible,\n        };\n      }\n      return null;\n    }\n    watch(\n      () => props.visible,\n      (val) => {\n        const newState = getDerivedStateFromProps({ ...props });\n        if (newState) {\n          Object.keys(newState).forEach((key) => {\n            state[key] = newState[key];\n          });\n        }\n      }\n    );\n\n    function setVisible(visible: boolean) {\n      if (!('visible' in props)) {\n        state.visible = visible;\n      }\n    }\n\n    function close(e: MouseEvent, value: VueJsxNode, tagKey: string | number) {\n      const { onClose } = props;\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n      onClose && onClose(value, e, tagKey);\n      // when user call e.preventDefault() in onClick callback, tag will not hidden\n      if (e.defaultPrevented) {\n        return;\n      }\n      setVisible(false);\n    }\n\n    function handleKeyDown(event: any) {\n      const { closable, onClick, onKeydown } = props;\n      switch (event.key) {\n        case 'Backspace':\n        case 'Delete':\n          closable && close(event, slots.default?.(), props.tagKey);\n          handlePrevent(event);\n          break;\n        case 'Enter':\n          onClick(event);\n          handlePrevent(event);\n          break;\n        case 'Escape':\n          event.target.blur();\n          break;\n        default:\n          break;\n      }\n      onKeydown && onKeydown(event);\n    }\n    function renderAvatar() {\n      const { avatarShape, avatarSrc } = props;\n      const avatar = <Avatar src={avatarSrc} shape={avatarShape} />;\n      return avatar;\n    }\n    return () => {\n      const children = slots.default ? slots.default() : null;\n      const {\n        tagKey,\n        size,\n        color,\n        closable,\n        visible,\n        onClose,\n        onClick,\n        className,\n        type,\n        shape,\n        avatarSrc,\n        avatarShape,\n        tabIndex,\n        prefixIcon,\n        suffixIcon,\n        ...attr\n      } = getProps(props);\n      const { visible: isVisible } = state;\n      const clickable = onClick !== defaultProps.onClick || closable;\n      // only when the Tag is clickable or closable, the value of tabIndex is allowed to be passed in.\n      const a11yProps: HTMLAttributes = { role: 'button', tabindex: tabIndex || 0, onKeydown: handleKeyDown };\n      const baseProps: HTMLAttributes = {\n        ...attr,\n        onClick,\n        tabindex: tabIndex,\n        class: classNames(\n          prefixCls,\n          {\n            [`${prefixCls}-default`]: size === 'default',\n            [`${prefixCls}-small`]: size === 'small',\n            [`${prefixCls}-large`]: size === 'large',\n            [`${prefixCls}-square`]: shape === 'square',\n            [`${prefixCls}-circle`]: shape === 'circle',\n            [`${prefixCls}-${type}`]: type,\n            [`${prefixCls}-${color}-${type}`]: color && type,\n            [`${prefixCls}-closable`]: closable,\n            [`${prefixCls}-invisible`]: !isVisible,\n            [`${prefixCls}-avatar-${avatarShape}`]: avatarSrc,\n          },\n          className\n        ),\n      };\n      const wrapProps = clickable ? { ...baseProps, ...a11yProps } : baseProps;\n      const closeIcon = closable ? (\n        <div class={`${prefixCls}-close`} onClick={(e) => close(e, children[0], tagKey)}>\n          <IconClose size=\"small\" />\n        </div>\n      ) : null;\n\n      const stringChild = isString(children);\n      const contentCls = cls(`${prefixCls}-content`, `${prefixCls}-content-${stringChild ? 'ellipsis' : 'center'}`);\n\n      const k = symbol();\n      return (\n        <div\n          aria-label={props['aria-label'] || stringChild ? `${closable ? 'Closable ' : ''}Tag: ${children}` : ''}\n          {...wrapProps}\n        >\n          {prefixIcon ? <div class={`${prefixCls}-prefix-icon`}>{prefixIcon}</div> : null}\n          {avatarSrc ? renderAvatar() : null}\n          <div class={contentCls} key={k}>\n            {children}\n          </div>\n          {suffixIcon ? <div class={`${prefixCls}-suffix-icon`}>{suffixIcon}</div> : null}\n          {closeIcon}\n        </div>\n      );\n    };\n  },\n});\n\nexport default Index;\n"],"names":["prefixCls","cssClasses","PREFIX","tagColors","strings","TAG_COLOR","tagSize","TAG_SIZE","tagType","TAG_TYPE","AVATAR_SHAPE","propTypes","tagKey","PropTypes","oneOfType","string","number","size","String","color","type","closable","bool","visible","onClose","func","onClick","style","object","className","avatarSrc","avatarShape","shape","default","onKeydown","Function","tabIndex","Number","onMouseenter","Array","prefixIcon","node","suffixIcon","defaultProps","vuePropsType","vuePropsMake","Index","defineComponent","props","name","setup","slots","getProps","useHasInProps","state","reactive","getDerivedStateFromProps","nextProps","watch","val","newState","Object","keys","forEach","key","setVisible","close","e","value","stopPropagation","stopImmediatePropagation","defaultPrevented","handleKeyDown","event","handlePrevent","target","blur","renderAvatar","_createVNode","Avatar","children","attr","isVisible","clickable","a11yProps","role","tabindex","baseProps","class","classNames","wrapProps","closeIcon","IconClose","stringChild","isString","contentCls","cls","k","symbol","_mergeProps"],"mappings":"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"}