{"version":3,"file":"dayCalendar.js","sources":["../../src/components/calendar/dayCalendar.tsx"],"sourcesContent":["import { isEqual } from 'lodash';\nimport cls from 'classnames';\nimport * as PropTypes from '../PropTypes';\nimport CalendarFoundation, {\n  CalendarAdapter,\n  ParsedEventsType,\n  ParsedEventsWithArray,\n} from '@douyinfe/semi-foundation/calendar/foundation';\nimport { cssClasses } from '@douyinfe/semi-foundation/calendar/constants';\nimport DayCol from './dayCol';\nimport TimeCol from './timeCol';\nimport LocaleConsumer from '../locale/localeConsumer';\nimport { Locale } from '../locale/interface';\nimport { DayCalendarProps } from './interface';\nimport '@douyinfe/semi-foundation/calendar/calendar.scss';\nimport {\n  ComponentObjectPropsOptions,\n  defineComponent,\n  h,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  reactive,\n  ref,\n  useSlots,\n  watch,\n} from 'vue';\nimport { vuePropsMake } from '../PropTypes';\nimport { useBaseComponent } from '../_base/baseComponent';\nimport { CombineProps } from '../interface';\n\nconst prefixCls = `${cssClasses.PREFIX}-day`;\n\nexport interface DayCalendarState {\n  scrollHeight: number;\n  parsedEvents: ParsedEventsWithArray;\n  cachedKeys: Array<string>;\n}\n\nconst propTypes: CombineProps<DayCalendarProps> = {\n  displayValue: PropTypes.object,\n  events: PropTypes.array,\n  header: PropTypes.node,\n  showCurrTime: PropTypes.bool,\n  onClick: PropTypes.func as PropType<DayCalendarProps['onClick']>,\n  // mode: PropTypes.string as PropType<DayCalendarProps['mode']>,\n  renderTimeDisplay: PropTypes.func as PropType<DayCalendarProps['renderTimeDisplay']>,\n  markWeekend: PropTypes.bool,\n  minEventHeight: PropTypes.number,\n  scrollTop: PropTypes.number,\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  style: PropTypes.object,\n  className: PropTypes.string,\n  dateGridRender: PropTypes.func as PropType<DayCalendarProps['dateGridRender']>,\n  allDayEventsRender: PropTypes.func as PropType<DayCalendarProps['allDayEventsRender']>,\n\n  range: PropTypes.array,\n  weekStartsOn: PropTypes.number as PropType<DayCalendarProps['weekStartsOn']>,\n  onClose: PropTypes.func as PropType<DayCalendarProps['onClose']>,\n  renderDateDisplay: PropTypes.func as PropType<DayCalendarProps['renderDateDisplay']>,\n};\n\nconst defaultProps = {\n  events: [] as DayCalendarProps['events'],\n  displayValue: new Date(),\n  // mode: 'day',\n};\nexport const vuePropsType = vuePropsMake<DayCalendarProps>(propTypes, defaultProps);\nconst DayCalendar = defineComponent({\n  props: { ...vuePropsType },\n  name: 'DayCalendar',\n  setup(props, {}) {\n    const slots = useSlots();\n    let dom = ref();\n    let scrollDom = ref();\n    let isWeekend: boolean = false;\n\n    const state = reactive<DayCalendarState>({\n      scrollHeight: 0,\n      parsedEvents: {\n        day: [],\n        allDay: [],\n      },\n      cachedKeys: [],\n    });\n\n    const { adapter: adapterInject, getDataAttr } = useBaseComponent<DayCalendarProps>(props, state);\n    function adapter_(): CalendarAdapter<DayCalendarProps, DayCalendarState> {\n      return {\n        ...adapterInject(),\n        updateScrollHeight: (scrollHeight) => {\n          state.scrollHeight = scrollHeight;\n        },\n        setParsedEvents: (parsedEvents: ParsedEventsType) => {\n          state.parsedEvents = parsedEvents as ParsedEventsWithArray;\n        },\n        cacheEventKeys: (cachedKeys) => {\n          state.cachedKeys = cachedKeys;\n        },\n      };\n    }\n    const adapter = adapter_();\n    const foundation = new CalendarFoundation(adapter);\n    onMounted(() => {\n      foundation.init();\n      const { scrollHeight } = scrollDom.value;\n      dom.value.scrollTop = props.scrollTop;\n      foundation.notifyScrollHeight(scrollHeight);\n      foundation.parseDailyEvents();\n    });\n\n    watch(\n      [() => state.cachedKeys, () => props.events, () => props.displayValue],\n      (value, [prevStateCachedKeys, _, prevPropsDisplayValue], onCleanup) => {\n        const prevEventKeys = prevStateCachedKeys;\n        const nowEventKeys = props.events.map((event) => event.key);\n        if (!isEqual(prevEventKeys, nowEventKeys) || !isEqual(prevPropsDisplayValue, props.displayValue)) {\n          foundation.parseDailyEvents();\n        }\n      }\n    );\n\n    onBeforeUnmount(() => {\n      foundation.destroy();\n    });\n\n    const checkWeekend = (val: Date) => foundation.checkWeekend(val);\n\n    const renderAllDayEvents = (events: ParsedEventsWithArray['allDay']) => {\n      if (props.allDayEventsRender) {\n        return props.allDayEventsRender(props.events);\n      }\n\n      const list = events.map((event, ind) => {\n        const { children, key } = event;\n        return (\n          // eslint-disable-next-line max-len\n          <li class={`${cssClasses.PREFIX}-event-item ${cssClasses.PREFIX}-event-allday`} key={key || `allDay-${ind}`}>\n            {children}\n          </li>\n        );\n      });\n      return list;\n    };\n\n    const handleClick = (e: MouseEvent, val: [Date, number, number, number]) => {\n      const { onClick } = props;\n      const value = foundation.formatCbValue(val);\n      onClick && onClick(e, value);\n    };\n\n    const renderAllDay = (events: ParsedEventsWithArray['allDay']) => {\n      const allDayCls = `${cssClasses.PREFIX}-all-day`;\n      const contentCls = cls(`${allDayCls}-content`, {\n        [`${cssClasses.PREFIX}-weekend`]: isWeekend,\n      });\n      return (\n        <LocaleConsumer componentName=\"Calendar\">\n          {(locale: Locale['Calendar']) => (\n            <div class={`${allDayCls}`}>\n              <ul class={`${cssClasses.PREFIX}-tag ${allDayCls}-tag ${prefixCls}-sticky-left`}>\n                <span>{locale.allDay}</span>\n              </ul>\n              <div role=\"gridcell\" class={contentCls}>\n                <ul class={`${cssClasses.PREFIX}-event-items`}>{renderAllDayEvents(events)}</ul>\n              </div>\n            </div>\n          )}\n        </LocaleConsumer>\n      );\n    };\n\n    return () => {\n      // eslint-disable-next-line max-len\n      const {\n        dateGridRender,\n        displayValue,\n        showCurrTime,\n        renderTimeDisplay,\n        markWeekend,\n        className,\n        height,\n        width,\n        style,\n        header,\n        minEventHeight,\n      } = props;\n      const dayCls = cls(prefixCls, className);\n      const dayStyle = {\n        height: typeof height === 'string' ? height : height + 'px',\n        width: typeof width === 'string' ? width : width + 'px',\n        ...style,\n      };\n      const { parsedEvents, scrollHeight } = state;\n      isWeekend = markWeekend && checkWeekend(displayValue);\n      return (\n        <div class={dayCls} style={dayStyle} ref={dom} {...getDataAttr()}>\n          <div class={`${prefixCls}-sticky-top`}>\n            {header}\n            {renderAllDay(parsedEvents.allDay)}\n          </div>\n          <div class={`${prefixCls}-scroll-wrapper`}>\n            <div class={`${prefixCls}-scroll`} ref={scrollDom}>\n              <TimeCol className={`${prefixCls}-sticky-left`} renderTimeDisplay={renderTimeDisplay} />\n              <DayCol\n                events={parsedEvents.day}\n                displayValue={displayValue}\n                scrollHeight={scrollHeight}\n                handleClick={handleClick}\n                showCurrTime={showCurrTime}\n                isWeekend={isWeekend}\n                dateGridRender={dateGridRender}\n              />\n            </div>\n          </div>\n        </div>\n      );\n    };\n  },\n});\n\nexport default DayCalendar;\n"],"names":["prefixCls","cssClasses","PREFIX","propTypes","displayValue","PropTypes","object","events","array","header","node","showCurrTime","bool","onClick","func","renderTimeDisplay","markWeekend","minEventHeight","number","scrollTop","width","oneOfType","string","height","style","className","dateGridRender","allDayEventsRender","range","weekStartsOn","onClose","renderDateDisplay","defaultProps","Date","vuePropsType","vuePropsMake","DayCalendar","defineComponent","props","name","setup","useSlots","dom","ref","scrollDom","isWeekend","state","reactive","scrollHeight","parsedEvents","day","allDay","cachedKeys","adapter","adapterInject","getDataAttr","useBaseComponent","adapter_","updateScrollHeight","setParsedEvents","cacheEventKeys","foundation","CalendarFoundation","onMounted","init","value","notifyScrollHeight","parseDailyEvents","watch","prevStateCachedKeys","_","prevPropsDisplayValue","onCleanup","prevEventKeys","nowEventKeys","map","event","key","isEqual","onBeforeUnmount","destroy","checkWeekend","val","renderAllDayEvents","ind","children","_createVNode","handleClick","e","formatCbValue","renderAllDay","allDayCls","contentCls","cls","LocaleConsumer","default","locale","dayCls","dayStyle","_mergeProps","TimeCol","DayCol"],"mappings":"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"}