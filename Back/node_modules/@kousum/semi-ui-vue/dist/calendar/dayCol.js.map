{"version":3,"file":"dayCol.js","sources":["../../src/components/calendar/dayCol.tsx"],"sourcesContent":["import cls from 'classnames';\nimport * as PropTypes from '../PropTypes';\nimport CalendarFoundation, { CalendarAdapter } from '@douyinfe/semi-foundation/calendar/foundation';\nimport { cssClasses } from '@douyinfe/semi-foundation/calendar/constants';\nimport { useBaseComponent } from '../_base/baseComponent';\nimport { DayColProps } from './interface';\nimport '@douyinfe/semi-foundation/calendar/calendar.scss';\nimport {\n  ComponentObjectPropsOptions, CSSProperties,\n  defineComponent,\n  Fragment,\n  h,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  reactive,\n  useSlots,\n} from 'vue';\nimport { vuePropsMake } from '../PropTypes';\nimport { CombineProps } from '../interface';\n\nconst prefixCls = `${cssClasses.PREFIX}-grid`;\n\nfunction pad(d: number) {\n  return d < 10 ? `0${d.toString()}` : d.toString();\n}\n\nexport interface DayColState {\n  currPos: number;\n  showCurrTime: boolean;\n}\n\nconst propTypes: CombineProps<DayColProps> = {\n  events: PropTypes.array,\n  displayValue: PropTypes.object,\n  showCurrTime: PropTypes.bool,\n  scrollHeight: {\n    type: PropTypes.number,\n    required: true,\n  },\n  currPos: PropTypes.number,\n  handleClick: {\n    type: PropTypes.func as PropType<DayColProps['handleClick']>,\n    required: true,\n  },\n  mode: PropTypes.string as PropType<DayColProps['mode']>,\n  minEventHeight: PropTypes.number,\n  isWeekend: {\n    type: PropTypes.bool,\n    required: true,\n  },\n  dateGridRender: PropTypes.func as PropType<DayColProps['dateGridRender']>,\n  style: Object as PropType<CSSProperties>,\n  className: String\n};\n\nconst defaultProps = {\n  events: [] as DayColProps['events'],\n  showCurrTime: true,\n  scrollHeight: 0,\n  currPos: 0,\n  mode: 'dayCol',\n  minEventHeight: Number.MIN_SAFE_INTEGER,\n};\nexport const vuePropsType = vuePropsMake<DayColProps>(propTypes, defaultProps);\nconst DayCol = defineComponent({\n  props: { ...vuePropsType },\n  name: 'DayCol',\n  setup(props, {}) {\n    const slots = useSlots();\n\n    const state = reactive<DayColState>({\n      currPos: 0,\n      showCurrTime: false,\n    });\n    const { adapter: adapterInject } = useBaseComponent<DayColProps>(props, state);\n    function adapter_(): CalendarAdapter<DayColProps, DayColState> {\n      return {\n        ...adapterInject(),\n        updateCurrPos: (currPos) => {\n          state.currPos = currPos;\n        },\n        updateShowCurrTime: () => {\n          state.showCurrTime = true;\n        },\n      };\n    }\n    const adapter = adapter_();\n    const foundation = new CalendarFoundation(adapter);\n\n    onMounted(() => {\n      foundation.init();\n      foundation.initCurrTime();\n    });\n\n    onBeforeUnmount(() => {\n      foundation.destroy();\n    });\n\n    const renderEvents = () => {\n      const { events, scrollHeight, minEventHeight } = props;\n      const list = events.map((event, ind) => {\n        const { startPos, endPos, children, key, left = 0 } = event;\n        const top = startPos * scrollHeight;\n        const height = (endPos - startPos) * scrollHeight;\n        const style = {\n          top: `${top}px`,\n          height: `${Math.max(minEventHeight, height)}px`,\n          left: left\n        };\n        return (\n          <li\n            class={`${cssClasses.PREFIX}-event-item ${cssClasses.PREFIX}-event-day`}\n            style={style}\n            key={key || `${top}-${ind}`}\n          >\n            {children}\n          </li>\n        );\n      });\n      return list;\n    };\n\n    const renderCurrTime = () => {\n      const { currPos } = state;\n      const { scrollHeight } = props;\n      const key = currPos;\n      const top = currPos * scrollHeight;\n      const style = { top: top + 'px' };\n      const circle = <div class={`${prefixCls}-curr-circle`} style={style} />;\n      const line = <div class={`${prefixCls}-curr-line`} style={style} />;\n      return (\n        <Fragment key={key}>\n          {circle}\n          {line}\n        </Fragment>\n      );\n    };\n\n    const handleClick: DayColProps['handleClick'] = (e, val) => {\n      props.handleClick(e, val);\n    };\n\n    const renderGrid = () => {\n      const showCurrTime = props.showCurrTime ? state.showCurrTime : false;\n      const { displayValue, isWeekend, dateGridRender } = props;\n      const skCls = cls(`${prefixCls}-skeleton`, {\n        [`${cssClasses.PREFIX}-weekend`]: isWeekend,\n      });\n      return (\n        <div class={`${prefixCls}`} role=\"presentation\">\n          <div role=\"gridcell\" class={`${prefixCls}-content`}>\n            {showCurrTime ? renderCurrTime() : null}\n            <ul role=\"row\" class={skCls}>\n              {[...Array(25).keys()].map((item) => {\n                const line = cls({\n                  [`${prefixCls}-skeleton-row-line`]: true,\n                });\n                return (\n                  <Fragment key={`${item}-daycol`}>\n                    <li\n                      data-time={`${pad(item)}:00:00`}\n                      class={line}\n                      onClick={(e) => handleClick(e, [displayValue, item, 0, 0])}\n                    />\n                    <li data-time={`${pad(item)}:30:00`} onClick={(e) => handleClick(e, [displayValue, item, 30, 0])} />\n                  </Fragment>\n                );\n              })}\n            </ul>\n            {dateGridRender && dateGridRender(displayValue.toString(), displayValue)}\n            <ul class={`${cssClasses.PREFIX}-event-items`}>{renderEvents()}</ul>\n          </div>\n        </div>\n      );\n    };\n\n    return () => {\n      const grid = renderGrid();\n      return grid;\n    };\n  },\n});\n\nexport default DayCol;\n"],"names":["prefixCls","cssClasses","PREFIX","pad","d","toString","propTypes","events","PropTypes","array","displayValue","object","showCurrTime","bool","scrollHeight","type","number","required","currPos","handleClick","func","mode","string","minEventHeight","isWeekend","dateGridRender","style","Object","className","String","defaultProps","Number","MIN_SAFE_INTEGER","vuePropsType","vuePropsMake","DayCol","defineComponent","props","name","setup","useSlots","state","reactive","adapter","adapterInject","useBaseComponent","adapter_","updateCurrPos","updateShowCurrTime","foundation","CalendarFoundation","onMounted","init","initCurrTime","onBeforeUnmount","destroy","renderEvents","map","event","ind","startPos","endPos","children","key","left","top","height","Math","max","_createVNode","renderCurrTime","circle","line","_Fragment","e","val","renderGrid","skCls","cls","Array","keys","item"],"mappings":"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"}