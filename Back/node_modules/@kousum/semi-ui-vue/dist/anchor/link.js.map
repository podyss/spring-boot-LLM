{"version":3,"file":"link.js","sources":["../../src/components/anchor/link.tsx"],"sourcesContent":["import cls from 'classnames';\nimport * as PropTypes from '../PropTypes';\nimport { cssClasses } from '@douyinfe/semi-foundation/anchor/constants';\nimport LinkFoundation, { LinkAdapter } from '@douyinfe/semi-foundation/anchor/linkFoundation';\nimport { Text as TypographyText } from '../typography/index';\nimport {\n  ComponentObjectPropsOptions,\n  CSSProperties,\n  defineComponent,\n  h,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  reactive,\n  ref,\n  useSlots,\n  watch,\n} from 'vue';\nimport { vuePropsMake } from '../PropTypes';\nimport { useAnchorContext } from './anchor-content/Consumer';\nimport { useBaseComponent } from '../_base/baseComponent';\nimport { TabsProps } from '../tabs';\nimport { CombineProps, VueJsxNode } from '../interface';\nimport { isObject } from 'lodash';\n\nconst prefixCls = cssClasses.PREFIX;\n\nexport interface LinkProps {\n  href?: string;\n  title?: VueJsxNode;\n  className?: string;\n  children?: VueJsxNode;\n  style?: CSSProperties;\n  disabled?: boolean;\n  level?: number;\n  direction?: 'ltr' | 'rtl';\n}\n\nconst propTypes: CombineProps<LinkProps> = {\n  href: PropTypes.string,\n  title: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n  className: PropTypes.string,\n  style: PropTypes.object,\n  disabled: PropTypes.bool,\n  level: PropTypes.number,\n  direction: PropTypes.string as PropType<LinkProps['direction']>,\n  children: PropTypes.node,\n};\n\nconst defaultProps = {\n  href: '#',\n  title: '',\n  className: '',\n};\nexport const vuePropsType = vuePropsMake(propTypes, defaultProps);\nconst Link = defineComponent({\n  props: { ...vuePropsType },\n  name: 'Link',\n  setup(props, {}) {\n    const slots = useSlots();\n    const { context } = useAnchorContext();\n\n    const state = reactive({});\n    const { adapter: adapterInject } = useBaseComponent<TabsProps>(props, state);\n    function adapter_(): LinkAdapter {\n      return {\n        ...adapterInject(),\n        addLink: (href) => {\n          context.value.addLink(href);\n        },\n        removeLink: (href) => {\n          context.value.removeLink(href);\n        },\n      };\n    }\n    const adapter = adapter_();\n    const foundation = new LinkFoundation(adapter);\n\n    function handleAddLink() {\n      foundation.handleAddLink();\n    }\n\n    function handleRemoveLink() {\n      foundation.handleRemoveLink();\n    }\n\n    function handleUpdateLink(href: string, prevHref: string) {\n      foundation.handleUpdateLink(href, prevHref);\n    }\n\n    function handleClick(e: KeyboardEvent | MouseEvent) {\n      const { disabled, href } = props;\n      const { onClick } = context.value;\n      !disabled && onClick(e as any, href);\n    }\n\n    onMounted(() => {\n      handleAddLink();\n    });\n\n    watch(\n      () => props.href,\n      (value, prevPropsHref) => {\n        const prevHref = prevPropsHref;\n        const { href } = props;\n        handleUpdateLink(href, prevHref);\n      }\n    );\n\n    onBeforeUnmount(() => {\n      handleRemoveLink();\n    });\n\n    const renderTitle = () => {\n      const { href, title, disabled = false } = props;\n      const { activeLink, showTooltip, position, size } = context.value;\n      const active = activeLink === href;\n      const linkTitleCls = cls(`${prefixCls}-link-tooltip`, {\n        [`${prefixCls}-link-tooltip-small`]: size === 'small',\n        [`${prefixCls}-link-tooltip-active`]: active,\n        [`${prefixCls}-link-tooltip-disabled`]: disabled,\n      });\n      if (showTooltip) {\n        const showTooltipObj = isObject(showTooltip) ? Object.assign({ opts: {} }, showTooltip) : { opts: {} };\n        // The position can be set through showTooltip, here it is compatible with the position API\n        if (position) {\n          showTooltipObj.opts['position'] = position;\n        }\n        return (\n          <TypographyText\n            size={size === 'default' ? 'normal' : 'small'}\n            ellipsis={{ showTooltip: showTooltipObj as any }}\n            type={'tertiary'}\n            className={linkTitleCls}\n          >\n            {title}\n          </TypographyText>\n        );\n      } else {\n        return title;\n      }\n    };\n\n    const renderChildren = () => {\n      const { activeLink, childMap } = context.value;\n      const { href, children } = props;\n      if (!context.value.autoCollapse) {\n        return <div role=\"list\">{children}</div>;\n      }\n      return activeLink === href || (childMap[href] && childMap[href].has(activeLink)) ? (\n        <div role=\"list\">{children}</div>\n      ) : null;\n    };\n\n    return () => {\n      const { href, className, style, disabled = false, title, level, direction } = props;\n      const { activeLink, showTooltip } = context.value;\n      const active = activeLink === href;\n      const linkCls = cls(`${prefixCls}-link`, className);\n      const linkTitleCls = cls(`${prefixCls}-link-title`, {\n        [`${prefixCls}-link-title-active`]: active,\n        [`${prefixCls}-link-title-disabled`]: disabled,\n      });\n      const paddingAttributeKey = direction === 'rtl' ? 'paddingRight' : 'paddingLeft';\n      const ariaProps = {\n        'aria-disabled': disabled,\n        style: {\n          [paddingAttributeKey]: 8 * level + 'px',\n        },\n      };\n      if (active) {\n        ariaProps['aria-details'] = 'active';\n      }\n      if (!showTooltip && typeof title === 'string') {\n        ariaProps['title'] = title;\n      }\n\n      return (\n        <div class={linkCls} style={style} role=\"listitem\">\n          <div\n            role=\"link\"\n            tabindex={0}\n            {...ariaProps}\n            class={linkTitleCls}\n            onClick={(e) => handleClick(e)}\n            onKeypress={(e) => handleClick(e)}\n          >\n            {renderTitle()}\n          </div>\n          {renderChildren()}\n        </div>\n      );\n    };\n  },\n});\n\nexport default Link;\n"],"names":["_isSlot","s","Object","prototype","toString","call","_isVNode","prefixCls","cssClasses","PREFIX","propTypes","href","PropTypes","string","title","oneOfType","node","className","style","object","disabled","bool","level","number","direction","children","defaultProps","vuePropsType","vuePropsMake","Link","defineComponent","props","name","setup","useSlots","context","useAnchorContext","state","reactive","adapter","adapterInject","useBaseComponent","adapter_","addLink","value","removeLink","foundation","LinkFoundation","handleAddLink","handleRemoveLink","handleUpdateLink","prevHref","handleClick","e","onClick","onMounted","watch","prevPropsHref","onBeforeUnmount","renderTitle","activeLink","showTooltip","position","size","active","linkTitleCls","cls","showTooltipObj","isObject","assign","opts","_createVNode","TypographyText","default","renderChildren","childMap","autoCollapse","has","linkCls","ariaProps","_mergeProps"],"mappings":"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"}