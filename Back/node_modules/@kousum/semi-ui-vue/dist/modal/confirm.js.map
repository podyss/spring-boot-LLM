{"version":3,"file":"confirm.js","sources":["../../src/components/modal/confirm.tsx"],"sourcesContent":["import {destroyFns, ModalReactProps,} from './Modal';\nimport ConfirmModal from './ConfirmModal';\n\nimport '@douyinfe/semi-foundation/modal/modal.scss';\n\nimport {\n  IconAlertCircle,\n  IconAlertTriangle,\n  IconHelpCircle,\n  IconInfoCircle,\n  IconTickCircle\n} from '@kousum/semi-icons-vue';\nimport { omit } from \"lodash\";\nimport { type ButtonProps } from \"../button\";\n\nimport {\n  h,\n  createApp,\n  App\n} from \"vue\";\n\nexport interface ConfirmProps extends ModalReactProps {\n  type: 'success' | 'info' | 'warning' | 'error' | 'confirm';\n}\n\nexport default function confirm<T>(props: ConfirmProps) {\n  // create a dom in adapter?\n  const div = document.createElement('div');\n  document.body.appendChild(div);\n\n  let app: App<Element>\n\n  let currentConfig = {...props};\n\n  const destroy = () => {\n    // TODO\n    // console.log(app);\n    app?.unmount()\n    if (div.parentNode) {\n      setTimeout(() => {\n        div.parentNode?.removeChild(div);\n      })\n    }\n\n    for (let i = 0; i < destroyFns.length; i++) {\n      const fn = destroyFns[i];\n\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      if (fn === destroy) {\n        destroyFns.splice(i, 1);\n        break;\n      }\n    }\n  };\n\n  // const mergedMotion: Motion = typeof (props.motion) === 'undefined' || props.motion ? {\n  //   ...(props.motion as any),\n  //   didLeave: (...args: any) => {\n  //     const didLeave = get(props.motion, 'didLeave');\n  //\n  //     if (typeof didLeave === 'function') {\n  //       didLeave(...args);\n  //     }\n  //\n  //     destroy();\n  //   }\n  //\n  // } : false;\n\n  function render(renderProps: ConfirmProps) {\n    const { afterClose } = renderProps;\n    // TODO\n    destroy()\n    app = createApp(h(ConfirmModal, {...renderProps, motion: props.motion, afterClose: ()=>{\n        //@ts-ignore\n        afterClose?.(...args);\n        destroy();\n      }}))\n    app.mount(div)\n  }\n\n  function close() {\n    currentConfig = {\n      ...currentConfig,\n      visible: false,\n    };\n    render(currentConfig);\n  }\n\n  function update(newConfig: T extends { type: Exclude<ConfirmProps['type'], 'confirm'> } ? ModalReactProps : ConfirmProps) {\n    currentConfig = {\n      ...currentConfig,\n      ...newConfig,\n    } as ConfirmProps;\n    render(currentConfig);\n  }\n\n  render(currentConfig);\n  destroyFns.push(destroy);\n  return {\n    destroy: destroy,\n    update,\n  };\n}\n\n\nexport function withInfo(props: ModalReactProps) {\n  return {\n    type: 'info' as const,\n    icon: <IconInfoCircle/>,\n    ...props\n  } as ConfirmProps;\n}\n\nexport function withSuccess(props: ModalReactProps) {\n  return {\n    type: 'success' as const,\n    icon: <IconTickCircle/>,\n    ...props\n  } as ConfirmProps;\n}\n\nexport function withWarning(props: ModalReactProps) {\n  return {\n    type: 'warning' as const,\n    icon: <IconAlertTriangle/>,\n    ...props\n  } as ConfirmProps;\n}\n\nexport function withError(props: ModalReactProps) {\n  return {\n    type: 'error' as const,\n    icon: <IconAlertCircle/>,\n    okButtonProps: { type: 'danger' as ButtonProps['type'], ...props.okButtonProps },\n    ...(omit(props, ['okButtonProps']) as ConfirmProps)\n  };\n}\n\nexport function withConfirm(props: ModalReactProps) {\n  return {\n    type: 'confirm' as const,\n    icon: <IconHelpCircle/>,\n    ...props\n  } as ConfirmProps;\n}\n"],"names":["confirm","props","div","document","createElement","body","appendChild","app","currentConfig","destroy","unmount","parentNode","setTimeout","removeChild","i","destroyFns","length","splice","render","renderProps","afterClose","createApp","h","ConfirmModal","motion","args","mount","update","newConfig","push","withInfo","type","icon","_createVNode","IconInfoCircle","withSuccess","IconTickCircle","withWarning","IconAlertTriangle","withError","IconAlertCircle","okButtonProps","omit","withConfirm","IconHelpCircle"],"mappings":";;;;;;AAyBe,SAASA,EAAWC,GAAqB;AAEtD,QAAMC,IAAMC,SAASC,cAAc,KAAK;AACxCD,WAASE,KAAKC,YAAYJ,CAAG;AAE7B,MAAIK,GAEAC,IAAgB;AAAA,IAAC,GAAGP;AAAAA;AAExB,QAAMQ,IAAUA,MAAM;AAGpBF,IAAAA,KAAAA,QAAAA,EAAKG,WACDR,EAAIS,cACNC,WAAW,MAAM;;AACfV,OAAAA,IAAAA,EAAIS,eAAJT,QAAAA,EAAgBW,YAAYX;AAAAA,IAC9B,CAAC;AAGH,aAASY,IAAI,GAAGA,IAAIC,EAAWC,QAAQF;AAIrC,UAHWC,EAAWD,CAAC,MAGZL,GAAS;AAClBM,QAAAA,EAAWE,OAAOH,GAAG,CAAC;AACtB;AAAA,MACF;AAAA;AAkBJ,WAASI,EAAOC,GAA2B;AACzC,UAAM;AAAA,MAAEC,YAAAA;AAAAA,IAAY,IAAGD;AAEvBV,IAAAA,KACAF,IAAMc,EAAUC,EAAEC,GAAc;AAAA,MAAC,GAAGJ;AAAAA,MAAaK,QAAQvB,EAAMuB;AAAAA,MAAQJ,YAAYA,MAAI;AAEnFA,QAAAA,KAAAA,QAAAA,EAAa,GAAGK,OAChBhB;MACF;AAAA,IAAE,CAAA,CAAC,GACLF,EAAImB,MAAMxB,CAAG;AAAA,EACf;AAUA,WAASyB,EAAOC,GAA0G;AACxHpB,IAAAA,IAAgB;AAAA,MACd,GAAGA;AAAAA,MACH,GAAGoB;AAAAA,OAELV,EAAOV,CAAa;AAAA,EACtB;AAEAU,SAAAA,EAAOV,CAAa,GACpBO,EAAWc,KAAKpB,CAAO,GAChB;AAAA,IACLA,SAASA;AAAAA,IACTkB,QAAAA;AAAAA;AAEJ;AAGO,SAASG,EAAS7B,GAAwB;AAC/C,SAAO;AAAA,IACL8B,MAAM;AAAA,IACNC,MAAIC,EAAAC,GAAmB,MAAA,IAAA;AAAA,IACvB,GAAGjC;AAAAA;AAEP;AAEO,SAASkC,EAAYlC,GAAwB;AAClD,SAAO;AAAA,IACL8B,MAAM;AAAA,IACNC,MAAIC,EAAAG,GAAmB,MAAA,IAAA;AAAA,IACvB,GAAGnC;AAAAA;AAEP;AAEO,SAASoC,EAAYpC,GAAwB;AAClD,SAAO;AAAA,IACL8B,MAAM;AAAA,IACNC,MAAIC,EAAAK,GAAsB,MAAA,IAAA;AAAA,IAC1B,GAAGrC;AAAAA;AAEP;AAEO,SAASsC,EAAUtC,GAAwB;AAChD,SAAO;AAAA,IACL8B,MAAM;AAAA,IACNC,MAAIC,EAAAO,GAAoB,MAAA,IAAA;AAAA,IACxBC,eAAe;AAAA,MAAEV,MAAM;AAAA,MAAiC,GAAG9B,EAAMwC;AAAAA,IAAe;AAAA,IAChF,GAAIC,EAAKzC,GAAO,CAAC,eAAe,CAAC;AAAA;AAErC;AAEO,SAAS0C,EAAY1C,GAAwB;AAClD,SAAO;AAAA,IACL8B,MAAM;AAAA,IACNC,MAAIC,EAAAW,GAAmB,MAAA,IAAA;AAAA,IACvB,GAAG3C;AAAAA;AAEP;"}