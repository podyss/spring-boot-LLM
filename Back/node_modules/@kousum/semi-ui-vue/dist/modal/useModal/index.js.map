{"version":3,"file":"index.js","sources":["../../../src/components/modal/useModal/index.tsx"],"sourcesContent":["import HookModal from './HookModal';\nimport {ConfirmProps, withConfirm, withError, withInfo, withSuccess, withWarning} from '../confirm';\nimport {ModalReactProps} from '../Modal';\nimport { h, Ref, ref, VNode, Fragment, watch, nextTick } from 'vue';\n\ntype Node = VNode\nlet uuid = 0;\n\nfunction usePatchElement(): ([Ref<Node[]>, (element: Node) => () => void]) {\n  const elements = ref<Node[]>([]);\n\n  function patchElement(element: Node) {\n    elements.value = [...Array.from(elements.value), element]\n    return () => {\n      elements.value = Array.from(elements.value).filter(ele => {\n        return ele !== element\n      })\n    };\n  }\n\n  return [elements, patchElement];\n}\n\ntype UseModalReturnHooksType = (config: ModalReactProps) => { destroy: () => void, update: (newConfig: ConfirmProps) => void };\n\nexport default function useModal(): [{\n  info: UseModalReturnHooksType,\n  success: UseModalReturnHooksType,\n  error: UseModalReturnHooksType,\n  warning: UseModalReturnHooksType,\n  confirm: UseModalReturnHooksType\n}, Ref<Node[]>] {\n  const [elements, patchElement] = usePatchElement();\n\n  // eslint-disable-next-line max-len\n  function getConfirmFunc(withFunc: (typeof withConfirm | typeof withInfo | typeof withSuccess | typeof withError | typeof withWarning)) {\n    return function hookConfirm(config: ModalReactProps) {\n      uuid += 1;\n\n\n      // for vue\n      function getModal(config_: ModalReactProps) {\n        // eslint-disable-next-line prefer-const\n        let closeFunc: () => void;\n        const modal: VNode = h(HookModal,\n          {\n            key: `semi-modal-${uuid}`,\n            config: withFunc(config_),\n            afterClose: () => {\n              closeFunc();\n            }\n          });\n\n        closeFunc = patchElement(modal);\n        return {\n          modal,\n          closeFunc\n        }\n      }\n\n      let modalObj = getModal(config)\n      return {\n        destroy: () => {\n          // for vue\n          modalObj.closeFunc()\n          modalObj = null\n\n          // if (modal) {\n            // 没有销毁方法 ？\n            // console.log(modal.destroy)\n            // modal.destroy();\n          // }\n        },\n        update: (newConfig: ConfirmProps) => {\n          // for vue\n          if (modalObj) {\n            modalObj.closeFunc()\n            nextTick(()=>{\n              modalObj = getModal(newConfig)\n            })\n\n            // modal.component.update();\n            // modal.component.update(newConfig);\n          }\n        },\n      };\n    };\n  }\n\n\n\n  return [\n    {\n      info: getConfirmFunc(withInfo),\n      success: getConfirmFunc(withSuccess),\n      error: getConfirmFunc(withError),\n      warning: getConfirmFunc(withWarning),\n      confirm: getConfirmFunc(withConfirm),\n    },\n    elements,\n  ];\n}\n"],"names":["uuid","usePatchElement","elements","ref","patchElement","element","value","Array","from","filter","ele","useModal","getConfirmFunc","withFunc","config","getModal","config_","closeFunc","modal","h","HookModal","key","afterClose","modalObj","destroy","update","newConfig","nextTick","info","withInfo","success","withSuccess","error","withError","warning","withWarning","confirm","withConfirm"],"mappings":";;;AAMA,IAAIA,IAAO;AAEX,SAASC,IAAkE;AACzE,QAAMC,IAAWC,EAAY,CAAA,CAAE;AAE/B,WAASC,EAAaC,GAAe;AACnCH,WAAAA,EAASI,QAAQ,CAAC,GAAGC,MAAMC,KAAKN,EAASI,KAAK,GAAGD,CAAO,GACjD,MAAM;AACXH,MAAAA,EAASI,QAAQC,MAAMC,KAAKN,EAASI,KAAK,EAAEG,OAAOC,CAAAA,MAC1CA,MAAQL,CAChB;AAAA;EAEL;AAEA,SAAO,CAACH,GAAUE,CAAY;AAChC;AAIe,SAASO,IAMR;AACd,QAAM,CAACT,GAAUE,CAAY,IAAIH,EAAe;AAGhD,WAASW,EAAeC,GAA+G;AACrI,WAAO,SAAqBC,GAAyB;AACnDd,MAAAA,KAAQ;AAIR,eAASe,EAASC,GAA0B;AAE1C,YAAIC;AACJ,cAAMC,IAAeC,EAAEC,GACrB;AAAA,UACEC,KAAK,cAAcrB,CAAI;AAAA,UACvBc,QAAQD,EAASG,CAAO;AAAA,UACxBM,YAAYA,MAAM;AAChBL,YAAAA;UACF;AAAA,QACF,CAAC;AAEHA,eAAAA,IAAYb,EAAac,CAAK,GACvB;AAAA,UACLA,OAAAA;AAAAA,UACAD,WAAAA;AAAAA;MAEJ;AAEA,UAAIM,IAAWR,EAASD,CAAM;AAC9B,aAAO;AAAA,QACLU,SAASA,MAAM;AAEbD,UAAAA,EAASN,UAAS,GAClBM,IAAW;AAAA,QAOZ;AAAA,QACDE,QAASC,CAAAA,MAA4B;AAEnC,UAAIH,MACFA,EAASN,UAAS,GAClBU,EAAS,MAAI;AACXJ,YAAAA,IAAWR,EAASW,CAAS;AAAA,UAC/B,CAAC;AAAA,QAKL;AAAA;;EAGN;AAIA,SAAO,CACL;AAAA,IACEE,MAAMhB,EAAeiB,CAAQ;AAAA,IAC7BC,SAASlB,EAAemB,CAAW;AAAA,IACnCC,OAAOpB,EAAeqB,CAAS;AAAA,IAC/BC,SAAStB,EAAeuB,CAAW;AAAA,IACnCC,SAASxB,EAAeyB,CAAW;AAAA,EACpC,GACDnC,CAAQ;AAEZ;"}