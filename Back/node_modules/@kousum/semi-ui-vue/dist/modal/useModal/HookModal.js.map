{"version":3,"file":"HookModal.js","sources":["../../../src/components/modal/useModal/HookModal.tsx"],"sourcesContent":["import ConfirmModal from '../ConfirmModal';\nimport { get } from 'lodash';\nimport { ConfirmProps } from '../confirm';\nimport { Motion } from '../../_base/base';\nimport { ComponentObjectPropsOptions, defineComponent, h, PropType, ref, useSlots } from 'vue';\nimport { CombineProps } from '../../interface';\n\ninterface HookModalProps {\n  afterClose: (...args: any[]) => void;\n  config: ConfirmProps;\n  motion?: Motion;\n}\n\nexport interface HookModalRef {\n  destroy: () => void;\n  update: (newConfig: ConfirmProps) => void;\n}\n// useImperativeHandle 定义子组件暴露给父组件的属性或方法\n\nexport const vuePropsType: CombineProps<HookModalProps> = {\n  afterClose: {\n    type: Function as PropType<HookModalProps['afterClose']>,\n    required: true,\n  },\n  config: {\n    type: Object,\n    required: true,\n  },\n  motion: [Object, Function],\n};\n\nconst HookModal = defineComponent({\n  props: { ...vuePropsType },\n  name: 'HookModal',\n  setup(props_, { expose }) {\n    const slots = useSlots();\n\n    const { afterClose, config, ...props } = props_;\n    const innerConfig = ref<ConfirmProps>(config);\n\n    expose({\n      destroy: () => {\n        innerConfig.value = {\n          ...innerConfig.value,\n          visible: false,\n        } as ConfirmProps;\n      },\n      update: (newConfig) => {\n        innerConfig.value = {\n          ...innerConfig.value,\n          ...newConfig,\n        } as ConfirmProps;\n      },\n    });\n\n    return () => {\n      const { motion } = props;\n      /* istanbul ignore next */\n      const mergedMotion =\n        typeof motion === 'undefined' || motion\n          ? {\n              ...(motion as any),\n              didLeave: (...args: any[]) => {\n                const didLeave = get(props.motion, 'didLeave') as (...value: any) => void;\n\n                if (typeof didLeave === 'function') {\n                  didLeave(...args);\n                }\n                afterClose();\n              },\n            }\n          : false;\n\n      // @ts-ignore\n      const innerConfig_ = innerConfig.value as ConfirmProps;\n      return (\n        <ConfirmModal\n          {...innerConfig_}\n          // visible={!visible ? visible : undefined}\n          motion={mergedMotion}\n        />\n      );\n    };\n  },\n});\n\nexport default HookModal;\n"],"names":["vuePropsType","afterClose","type","Function","required","config","Object","motion","HookModal","defineComponent","props","name","setup","props_","expose","useSlots","innerConfig","ref","destroy","value","visible","update","newConfig","mergedMotion","didLeave","args","get","innerConfig_","_createVNode","ConfirmModal","_mergeProps"],"mappings":";;;AAmBO,MAAMA,IAA6C;AAAA,EACxDC,YAAY;AAAA,IACVC,MAAMC;AAAAA,IACNC,UAAU;AAAA,EACX;AAAA,EACDC,QAAQ;AAAA,IACNH,MAAMI;AAAAA,IACNF,UAAU;AAAA,EACX;AAAA,EACDG,QAAQ,CAACD,QAAQH,QAAQ;AAC3B,GAEMK,IAAYC,gBAAAA,EAAgB;AAAA,EAChCC,OAAO;AAAA,IAAE,GAAGV;AAAAA,EAAc;AAAA,EAC1BW,MAAM;AAAA,EACNC,MAAMC,GAAQ;AAAA,IAAEC,QAAAA;AAAAA,EAAO,GAAG;AACVC,IAAAA,EAAU;AAExB,UAAM;AAAA,MAAEd,YAAAA;AAAAA,MAAYI,QAAAA;AAAAA,MAAQ,GAAGK;AAAAA,IAAO,IAAGG,GACnCG,IAAcC,EAAkBZ,CAAM;AAE5CS,WAAAA,EAAO;AAAA,MACLI,SAASA,MAAM;AACbF,QAAAA,EAAYG,QAAQ;AAAA,UAClB,GAAGH,EAAYG;AAAAA,UACfC,SAAS;AAAA;MAEZ;AAAA,MACDC,QAASC,CAAAA,MAAc;AACrBN,QAAAA,EAAYG,QAAQ;AAAA,UAClB,GAAGH,EAAYG;AAAAA,UACf,GAAGG;AAAAA;MAEP;AAAA,IACF,CAAC,GAEM,MAAM;AACX,YAAM;AAAA,QAAEf,QAAAA;AAAAA,MAAQ,IAAGG,GAEba,IACJ,OAAOhB,IAAW,OAAeA,IAC7B;AAAA,QACE,GAAIA;AAAAA,QACJiB,UAAUA,IAAIC,MAAgB;AAC5B,gBAAMD,IAAWE,EAAIhB,EAAMH,QAAQ,UAAU;AAE7C,UAAI,OAAOiB,KAAa,cACtBA,EAAS,GAAGC,CAAI,GAElBxB;QACF;AAAA,MACD,IACD,IAGA0B,IAAeX,EAAYG;AACjC,aAAAS,EAAAC,GAAAC,EAEQH,GAAY;AAAA,QAAA,QAERJ;AAAAA,MAAY,CAAA,GAAA,IAAA;AAAA;EAI5B;AACF,CAAC;"}