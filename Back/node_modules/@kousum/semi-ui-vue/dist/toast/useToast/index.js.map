{"version":3,"file":"index.js","sources":["../../../src/components/toast/useToast/index.tsx"],"sourcesContent":["import getUuid from '@douyinfe/semi-foundation/utils/uuid';\nimport HookToast from './HookToast';\nimport { ToastInstance, ToastProps } from '@douyinfe/semi-foundation/toast/toastFoundation';\nimport { h, Fragment, ref, Ref, VNode, watch, shallowRef, unref } from 'vue';\nimport { noop } from 'lodash';\n\n// const ref = null;\n// TODO: toast larger than N bars, automatic folding, allowing expansion, N configurable\n\nconst defaultOpts = {\n  motion: true,\n  zIndex: 1010,\n  duration: 3,\n};\n\nfunction usePatchElement(): [Ref<any[]>, typeof patchElement] {\n  const elements = ref([]);\n  function patchElement(element: any, config: ToastInstance) {\n    elements.value = [{ element, config }, ...unref(elements)]\n\n    return (id: string) => {\n      elements.value = unref(elements).filter(({ config: configOfCurrentElement }) => configOfCurrentElement.id !== id)\n    };\n  }\n\n  return [elements, patchElement];\n}\n\nexport type ToastFuncType = {\n  success: (config: ToastProps) => string;\n  info: (config: ToastProps) => string;\n  error: (config: ToastProps) => string;\n  warning: (config: ToastProps) => string;\n  open: (config: ToastProps) => string;\n  close: (id: string) => void;\n};\n\nexport default function useToast(): [ToastFuncType, Ref<VNode>] {\n  const [elements, patchElement] = usePatchElement();\n  const toastRef = new Map<string, { close: () => void }>();\n\n  const addToast = (config: ToastProps) => {\n    const id = getUuid('semi_toast_');\n    const mergeConfig = {\n      ...config,\n      id,\n    };\n    // eslint-disable-next-line prefer-const\n    let closeFunc: ReturnType<typeof patchElement>;\n\n    const toast = (\n      <HookToast\n        {...mergeConfig}\n        key={id}\n        afterClose={(instanceId) => closeFunc(instanceId)}\n        onMyMounted={(data: { close: () => void }) => {\n          toastRef.set(id, { close: data?.close ?? noop });\n        }}\n      />\n    );\n    closeFunc = patchElement(toast, { ...mergeConfig });\n    return id;\n  };\n\n  const removeElement = (id: string) => {\n    const ele = toastRef.get(id);\n    ele && ele.close();\n  };\n\n  const dom = ref<VNode>();\n  watch(\n    () => elements.value,\n    (value) => {\n      dom.value = (\n        <Fragment>\n          {Array.isArray(elements.value) && elements.value.length ? (\n            <Fragment>{elements.value.map((item) => item.element)}</Fragment>\n          ) : null}\n        </Fragment>\n      );\n    }\n  );\n  return [\n    {\n      success: (config: ToastProps) => addToast({ ...defaultOpts, ...config, type: 'success' }),\n      info: (config: ToastProps) => addToast({ ...defaultOpts, ...config, type: 'info' }),\n      error: (config: ToastProps) => addToast({ ...defaultOpts, ...config, type: 'error' }),\n      warning: (config: ToastProps) => addToast({ ...defaultOpts, ...config, type: 'warning' }),\n      open: (config: ToastProps) => addToast({ ...defaultOpts, ...config, type: 'default' }),\n      close: (id: string) => removeElement(id),\n    },\n    dom,\n  ];\n}\n"],"names":["defaultOpts","motion","zIndex","duration","usePatchElement","elements","ref","patchElement","element","config","value","unref","id","filter","configOfCurrentElement","useToast","toastRef","Map","addToast","getUuid","mergeConfig","closeFunc","toast","_createVNode","HookToast","_mergeProps","instanceId","data","set","close","noop","removeElement","ele","get","dom","watch","_Fragment","Array","isArray","length","map","item","success","type","info","error","warning","open"],"mappings":";;;;AASA,MAAMA,IAAc;AAAA,EAClBC,QAAQ;AAAA,EACRC,QAAQ;AAAA,EACRC,UAAU;AACZ;AAEA,SAASC,IAAqD;AAC5D,QAAMC,IAAWC,EAAI,CAAA,CAAE;AACvB,WAASC,EAAaC,GAAcC,GAAuB;AACzDJ,WAAAA,EAASK,QAAQ,CAAC;AAAA,MAAEF,SAAAA;AAAAA,MAASC,QAAAA;AAAAA,IAAO,GAAG,GAAGE,EAAMN,CAAQ,CAAC,GAEjDO,CAAAA,MAAe;AACrBP,MAAAA,EAASK,QAAQC,EAAMN,CAAQ,EAAEQ,OAAO,CAAC;AAAA,QAAEJ,QAAQK;AAAAA,MAAuB,MAAMA,EAAuBF,OAAOA,CAAE;AAAA;EAEpH;AAEA,SAAO,CAACP,GAAUE,CAAY;AAChC;AAWe,SAASQ,IAAwC;AAC9D,QAAM,CAACV,GAAUE,CAAY,IAAIH,EAAe,GAC1CY,IAAW,oBAAIC,OAEfC,IAAYT,CAAAA,MAAuB;AACvC,UAAMG,IAAKO,EAAQ,aAAa,GAC1BC,IAAc;AAAA,MAClB,GAAGX;AAAAA,MACHG,IAAAA;AAAAA;AAGF,QAAIS;AAEJ,UAAMC,IAAKC,EAAAC,GAAAC,EAEHL,GAAW;AAAA,MAAA,KACVR;AAAAA,MAAE,YACMc,CAAAA,MAAeL,EAAUK,CAAU;AAAA,MAAC,aACnCC,CAAAA,MAAgC;AAC5CX,QAAAA,EAASY,IAAIhB,GAAI;AAAA,UAAEiB,QAAOF,KAAAA,gBAAAA,EAAME,UAASC;AAAAA,QAAK,CAAC;AAAA,MACjD;AAAA,KAEH,GAAA,IAAA;AACDT,WAAAA,IAAYd,EAAae,GAAO;AAAA,MAAE,GAAGF;AAAAA,IAAY,CAAC,GAC3CR;AAAAA,KAGHmB,IAAiBnB,CAAAA,MAAe;AACpC,UAAMoB,IAAMhB,EAASiB,IAAIrB,CAAE;AAC3BoB,IAAAA,KAAOA,EAAIH;KAGPK,IAAM5B;AACZ6B,SAAAA,EACE,MAAM9B,EAASK,OACdA,CAAAA,MAAU;AACTwB,IAAAA,EAAIxB,QAAKa,EAAAa,UAEJC,MAAMC,QAAQjC,EAASK,KAAK,KAAKL,EAASK,MAAM6B,SAAMhB,EAAAa,UAC1C/B,EAASK,MAAM8B,IAAKC,CAAAA,MAASA,EAAKjC,OAAO,CAAC,CAAA,IACnD,IAAI,CAEX;AAAA,EACH,CACF,GACO,CACL;AAAA,IACEkC,SAAUjC,CAAAA,MAAuBS,EAAS;AAAA,MAAE,GAAGlB;AAAAA,MAAa,GAAGS;AAAAA,MAAQkC,MAAM;AAAA,IAAU,CAAC;AAAA,IACxFC,MAAOnC,CAAAA,MAAuBS,EAAS;AAAA,MAAE,GAAGlB;AAAAA,MAAa,GAAGS;AAAAA,MAAQkC,MAAM;AAAA,IAAO,CAAC;AAAA,IAClFE,OAAQpC,CAAAA,MAAuBS,EAAS;AAAA,MAAE,GAAGlB;AAAAA,MAAa,GAAGS;AAAAA,MAAQkC,MAAM;AAAA,IAAQ,CAAC;AAAA,IACpFG,SAAUrC,CAAAA,MAAuBS,EAAS;AAAA,MAAE,GAAGlB;AAAAA,MAAa,GAAGS;AAAAA,MAAQkC,MAAM;AAAA,IAAU,CAAC;AAAA,IACxFI,MAAOtC,CAAAA,MAAuBS,EAAS;AAAA,MAAE,GAAGlB;AAAAA,MAAa,GAAGS;AAAAA,MAAQkC,MAAM;AAAA,IAAU,CAAC;AAAA,IACrFd,OAAQjB,CAAAA,MAAemB,EAAcnB,CAAE;AAAA,EACxC,GACDsB,CAAG;AAEP;"}