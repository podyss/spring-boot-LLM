{"version":3,"file":"toast.js","sources":["../../src/components/toast/toast.tsx"],"sourcesContent":["import cls from 'classnames';\nimport * as PropTypes from '../PropTypes';\nimport ToastFoundation, { ToastAdapter, ToastState, ToastProps } from '@douyinfe/semi-foundation/toast/toastFoundation';\nimport { numbers, cssClasses, strings } from '@douyinfe/semi-foundation/toast/constants';\nimport Button from '../iconButton/index';\nimport { IconClose, IconAlertTriangle, IconInfoCircle, IconTickCircle, IconAlertCircle } from '@kousum/semi-icons-vue';\nimport { noop } from 'lodash';\nimport { isSemiIcon } from '../_utils';\nimport {\n  cloneVNode,\n  ComponentObjectPropsOptions,\n  CSSProperties,\n  defineComponent,\n  h,\n  onBeforeUnmount,\n  onMounted,\n  onUnmounted,\n  PropType,\n  reactive,\n  ref,\n  useSlots,\n  VNode,\n} from 'vue';\nimport { vuePropsMake } from '../PropTypes';\nimport { CombineProps, VueJsxNode } from '../interface';\nimport { useConfigContext } from '../configProvider/context/Consumer';\nimport { useBaseComponent } from '../_base/baseComponent';\n\nconst prefixCls = cssClasses.PREFIX;\n\nexport interface ToastReactProps extends ToastProps {\n  style?: CSSProperties;\n  icon?: VueJsxNode;\n  content: VueJsxNode;\n  stack?: boolean;\n  stackExpanded?: boolean;\n  onAnimationEnd?: (e: AnimationEvent) => void;\n  onAnimationStart?: (e: AnimationEvent) => void;\n  positionInList?: {\n    index: number;\n    length: number;\n  };\n  id?: string;\n}\n\nexport const propTypes: CombineProps<ToastReactProps> = {\n  onClose: PropTypes.func as PropType<ToastReactProps['onClose']>,\n  content: {\n    type: PropTypes.node,\n    required: true\n  },\n  close: PropTypes.func as PropType<ToastReactProps['close']>,\n  duration: PropTypes.number,\n  theme: String as PropType<ToastReactProps['theme']>,\n  type: String as PropType<ToastReactProps['type']>,\n  textMaxWidth: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  style: PropTypes.object,\n  className: PropTypes.string,\n  showClose: PropTypes.bool,\n  stack: PropTypes.bool,\n  stackExpanded: PropTypes.bool,\n  onAnimationEnd: PropTypes.func as PropType<ToastReactProps['onAnimationEnd']>,\n  onAnimationStart: PropTypes.func as PropType<ToastReactProps['onAnimationStart']>,\n  positionInList: PropTypes.object as PropType<ToastReactProps['positionInList']>,\n  icon: PropTypes.node,\n  direction: String as PropType<ToastReactProps['direction']>,\n  id: String as PropType<ToastReactProps['id']>,\n  top: [PropTypes.string,PropTypes.number],\n  bottom: [PropTypes.string,PropTypes.number],\n  left: [PropTypes.string,PropTypes.number],\n  right: [PropTypes.string,PropTypes.number],\n  zIndex: PropTypes.number,\n  getPopupContainer: PropTypes.func as PropType<ToastReactProps['getPopupContainer']>,\n};\nconst defaultProps = {\n  onClose: noop,\n  content: '',\n  close: noop,\n  duration: numbers.duration,\n  textMaxWidth: 450,\n  showClose: true,\n  stack: false,\n  stackExpanded: false,\n  theme: 'normal',\n};\n\nexport const vuePropsType = vuePropsMake(propTypes, defaultProps);\nconst Toast = defineComponent({\n  props: { ...vuePropsType },\n  name: 'Toast',\n  setup(props, { expose }) {\n    const slots = useSlots();\n\n    const { context } = useConfigContext();\n    const state = reactive<ToastState>({});\n    let toastEle = ref();\n\n    const { adapter: adapterInject } = useBaseComponent<ToastReactProps>(props, state);\n    function adapter_(): ToastAdapter {\n      return {\n        ...adapterInject<ToastReactProps, ToastState>(),\n        notifyWrapperToRemove: (id: string) => {\n          props.close(id);\n        },\n        notifyClose: () => {\n          props.onClose();\n        },\n      };\n    }\n    const adapter = adapter_();\n    const foundation = new ToastFoundation(adapter);\n\n    onMounted(() => {\n      foundation.init();\n    });\n    onBeforeUnmount(() => {\n      foundation.destroy();\n    });\n\n    function close(e: MouseEvent) {\n      foundation.close(e);\n    }\n\n    const clearCloseTimer = () => {\n      foundation.clearCloseTimer_();\n    };\n\n    const startCloseTimer = () => {\n      foundation.startCloseTimer_();\n    };\n\n    const restartCloseTimer = () => {\n      foundation.restartCloseTimer();\n    };\n\n    function renderIcon() {\n      const { type, icon } = props;\n      const iconMap = {\n        warning: <IconAlertTriangle />,\n        success: <IconTickCircle />,\n        info: <IconInfoCircle />,\n        error: <IconAlertCircle />,\n      };\n      const iconType = iconMap[type];\n      const iconSize = 'large';\n      const iconCls = cls(`${prefixCls}-icon`, `${prefixCls}-icon-${type}`);\n      if (icon) {\n        return isSemiIcon(icon) ? cloneVNode(icon as VNode, { size: iconSize, class: `${prefixCls}-icon` }) : icon;\n      }\n      if (type && iconType) {\n        return cloneVNode(iconType, { size: iconSize, class: iconCls });\n      }\n      return null;\n    }\n\n    // onUnmounted(()=>{\n    //     console.log('toast 销毁')\n    // })\n\n    // TODO\n    expose({\n      foundation,\n      close,\n    });\n    return () => {\n      const { content, type, theme, showClose, textMaxWidth, className, style } = props;\n      const direction = props.direction || context.value.direction;\n      const toastCls = cls(prefixCls, className, {\n        [`${prefixCls}-${type}`]: true,\n        [`${prefixCls}-${theme}`]: theme === 'light',\n        [`${prefixCls}-rtl`]: direction === 'rtl',\n      });\n      const textStyle: CSSProperties = {};\n      textStyle.maxWidth = textMaxWidth;\n      const btnTheme = 'borderless';\n      const btnSize = 'small';\n\n      const reservedIndex = props.positionInList ? props.positionInList.length - props.positionInList.index - 1 : 0;\n      const toastEle_ = (\n        <div\n          ref={toastEle}\n          role=\"alert\"\n          aria-label={`${type ? type : 'default'} type`}\n          class={toastCls}\n          style={{\n            ...style,\n            transform: `translate3d(0,0,${reservedIndex * -10}px)`,\n          }}\n          onMouseenter={clearCloseTimer}\n          onMouseleave={startCloseTimer}\n          onAnimationstart={props.onAnimationStart}\n          onAnimationend={props.onAnimationEnd}\n        >\n          <div class={`${prefixCls}-content`}>\n            {renderIcon()}\n            <span class={`${prefixCls}-content-text`} style={textStyle} x-semi-prop=\"content\">\n              {content}\n            </span>\n            {showClose && (\n              <div class={`${prefixCls}-close-button`}>\n                <Button\n                  onClick={(e) => close(e)}\n                  type=\"tertiary\"\n                  icon={<IconClose x-semi-prop=\"icon\" />}\n                  theme={btnTheme}\n                  size={btnSize}\n                />\n              </div>\n            )}\n          </div>\n        </div>\n      );\n      if (props.stack) {\n        const height = (props.stackExpanded && toastEle.value && getComputedStyle(toastEle.value).height) || 0;\n        return (\n          <div class={`${prefixCls}-zero-height-wrapper`} style={{ height }}>\n            {toastEle_}\n          </div>\n        );\n      } else {\n        return toastEle_;\n      }\n    };\n  },\n});\n\nexport default Toast;\n"],"names":["prefixCls","cssClasses","PREFIX","propTypes","onClose","PropTypes","func","content","type","node","required","close","duration","number","theme","String","textMaxWidth","oneOfType","string","style","object","className","showClose","bool","stack","stackExpanded","onAnimationEnd","onAnimationStart","positionInList","icon","direction","id","top","bottom","left","right","zIndex","getPopupContainer","defaultProps","noop","numbers","vuePropsType","vuePropsMake","Toast","defineComponent","props","name","setup","expose","useSlots","context","useConfigContext","state","reactive","toastEle","ref","adapter","adapterInject","useBaseComponent","adapter_","notifyWrapperToRemove","notifyClose","foundation","ToastFoundation","onMounted","init","onBeforeUnmount","destroy","e","clearCloseTimer","clearCloseTimer_","startCloseTimer","startCloseTimer_","renderIcon","iconType","warning","_createVNode","IconAlertTriangle","success","IconTickCircle","info","IconInfoCircle","error","IconAlertCircle","iconSize","iconCls","cls","isSemiIcon","cloneVNode","size","class","value","toastCls","textStyle","maxWidth","btnTheme","btnSize","reservedIndex","length","index","toastEle_","transform","Button","IconClose","height","getComputedStyle"],"mappings":"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"}