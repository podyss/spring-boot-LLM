{"version":3,"file":"index.js","sources":["../../../src/components/colorPicker/ColorChooseArea/index.tsx"],"sourcesContent":["import { hsvaToHslString, hsvaToRgba } from '@douyinfe/semi-foundation/colorPicker/utils/convert';\nimport { cssClasses } from '@douyinfe/semi-foundation/colorPicker/constants';\nimport cls from 'classnames';\nimport ColorChooseAreaFoundation, {\n  ColorChooseAreaAdapter,\n  ColorChooseAreaBaseProps,\n  ColorChooseAreaBaseState,\n} from '@douyinfe/semi-foundation/colorPicker/ColorChooseAreaFoundation';\nimport { round } from '@douyinfe/semi-foundation/colorPicker/utils/round';\nimport { CSSProperties, defineComponent, h, PropType, reactive, ref, useSlots, watch } from 'vue';\nimport { CombineProps } from '../../interface';\nimport { useBaseComponent } from '../../_base/baseComponent';\n\nexport interface ColorChooseAreaProps extends ColorChooseAreaBaseProps {\n  className?: string;\n  style?: CSSProperties;\n}\n\nexport interface ColorChooseAreaState extends ColorChooseAreaBaseState {}\n\nexport const vuePropsType: CombineProps<ColorChooseAreaProps> = {\n  className: String,\n  style: Object,\n  foundation: {\n    type: Object,\n    required: true,\n  },\n  handleSize: {\n    type: Number,\n    required: true,\n  },\n  height: {\n    type: Number,\n    required: true,\n  },\n  hsva: {\n    type: Object,\n    required: true,\n  },\n  width: {\n    type: Number,\n    required: true,\n  },\n  onChange: {\n    type: Function as PropType<ColorChooseAreaProps['onChange']>,\n    required: true,\n  },\n};\nconst ColorChooseArea = defineComponent({\n  props: { ...vuePropsType },\n  name: 'ColorChooseArea',\n  setup(props, { attrs }) {\n    const slots = useSlots();\n    const dom = ref();\n    const state = reactive<ColorChooseAreaState>({\n      handlePosition: { x: 0, y: 0 },\n      isHandleGrabbing: false,\n    });\n    const { adapter: adapterInject } = useBaseComponent(props, state);\n    function adapter_(): ColorChooseAreaAdapter<ColorChooseAreaProps, ColorChooseAreaState> {\n      return {\n        ...adapterInject(),\n        getColorPickerFoundation: () => props.foundation,\n        handleMouseDown: (e: MouseEvent) => {\n          state.isHandleGrabbing = true;\n          dom.value?.addEventListener('mousemove', foundation.setHandlePositionByMousePosition);\n          window.addEventListener('mouseup', foundation.handleMouseUp);\n        },\n        handleMouseUp: () => {\n          dom.value?.removeEventListener('mousemove', foundation.setHandlePositionByMousePosition);\n          window.removeEventListener('mouseup', foundation.handleMouseUp);\n          state.isHandleGrabbing = false;\n        },\n        getDOM: () => dom.value,\n        notifyChange: (newColor) => props.onChange(newColor),\n      };\n    }\n    const adapter = adapter_();\n    const foundation = new ColorChooseAreaFoundation(adapter);\n    state.handlePosition = foundation.getHandlePositionByHSVA();\n\n    watch(\n      [() => props.hsva],\n      (value, [prevPropsHsva], onCleanup) => {\n        if (JSON.stringify(prevPropsHsva) !== JSON.stringify(props.hsva)) {\n          state.handlePosition = foundation.getHandlePositionByHSVA();\n        }\n      },\n      { deep: true }\n    );\n\n    const handleClick = (e: MouseEvent) => {\n      foundation.setHandlePositionByMousePosition(e);\n      foundation.handleMouseDown(e);\n    };\n\n    return () => {\n      const areaBgStyle = hsvaToHslString({ h: props.hsva.h, s: 100, v: 100, a: 1 });\n      const currentColor = hsvaToRgba(props.hsva);\n      return (\n        <div\n          class={cls(`${cssClasses.PREFIX}-colorChooseArea`, props.className)}\n          style={{\n            backgroundColor: areaBgStyle,\n            width: props.width + 'px',\n            height: props.height + 'px',\n            cursor: state.isHandleGrabbing ? 'grabbing' : 'pointer',\n            ...props.style,\n          }}\n          ref={dom}\n          aria-label=\"Color\"\n          onMousedown={handleClick}\n          aria-valuetext={`Saturation ${round(props.hsva.s)}%, Brightness ${round(props.hsva.v)}%`}\n        >\n          <div\n            class={`${cssClasses.PREFIX}-handle`}\n            style={{\n              width: props.handleSize + 'px',\n              height: props.handleSize + 'px',\n              left: state.handlePosition.x + 'px',\n              top: state.handlePosition.y + 'px',\n              backgroundColor: `rgba(${currentColor.r},${currentColor.g},${currentColor.b},${currentColor.a})`,\n            }}\n            onMousedown={(e) => foundation.handleMouseDown(e)}\n          ></div>\n        </div>\n      );\n    };\n  },\n});\n\nexport default ColorChooseArea;\n"],"names":["vuePropsType","className","String","style","Object","foundation","type","required","handleSize","Number","height","hsva","width","onChange","Function","ColorChooseArea","defineComponent","props","name","setup","attrs","useSlots","dom","ref","state","reactive","handlePosition","x","y","isHandleGrabbing","adapter","adapterInject","useBaseComponent","adapter_","getColorPickerFoundation","handleMouseDown","e","value","addEventListener","setHandlePositionByMousePosition","window","handleMouseUp","removeEventListener","getDOM","notifyChange","newColor","ColorChooseAreaFoundation","getHandlePositionByHSVA","watch","prevPropsHsva","onCleanup","JSON","stringify","deep","handleClick","areaBgStyle","hsvaToHslString","h","s","v","a","currentColor","hsvaToRgba","_createVNode","cls","cssClasses","PREFIX","backgroundColor","cursor","round","left","top","r","g","b"],"mappings":"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"}