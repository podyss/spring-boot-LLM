{"version":3,"file":"checkbox.js","sources":["../../src/components/checkbox/checkbox.tsx"],"sourcesContent":["import { defineComponent, ref, h, Fragment, useSlots, CSSProperties, VNode, reactive, inject, watch } from 'vue';\nimport classnames from 'classnames';\nimport * as PropTypes from '../PropTypes';\nimport { checkboxClasses as css, strings } from '@douyinfe/semi-foundation/checkbox/constants';\nimport CheckboxFoundation, {\n  CheckboxAdapter,\n  BasicCheckboxEvent,\n  BasicTargetObject,\n  BaseCheckboxProps,\n} from '@douyinfe/semi-foundation/checkbox/checkboxFoundation';\nimport CheckboxInner from './checkboxInner';\nimport { useBaseComponent, useHasInProps } from '../_base/baseComponent';\nimport '@douyinfe/semi-foundation/checkbox/checkbox.scss';\nimport { isUndefined, isBoolean, noop } from 'lodash';\nimport { getUuidShort } from '@douyinfe/semi-foundation/utils/uuid';\nimport { CheckboxType } from './checkboxGroup';\n\nexport type CheckboxEvent = BasicCheckboxEvent;\nexport type TargetObject = BasicTargetObject;\nimport { AriaAttributes } from '../AriaAttributes';\nimport { useCheckboxContext } from './context/Consumer';\nimport { vuePropsMake } from '../PropTypes';\nimport { propTypesCheckbox } from './propType';\n\n// import {TagInputProps} from \"../tagInput/Index\";\n\nexport interface CheckboxProps extends BaseCheckboxProps {\n  'aria-describedby'?: AriaAttributes['aria-describedby'];\n  'aria-errormessage'?: AriaAttributes['aria-errormessage'];\n  'aria-invalid'?: AriaAttributes['aria-invalid'];\n  'aria-labelledby'?: AriaAttributes['aria-labelledby'];\n  'aria-required'?: AriaAttributes['aria-required'];\n  onChange?: (e: CheckboxEvent) => any;\n  // TODO, docs\n  style?: CSSProperties;\n  onMouseEnter?: any;\n  onMouseLeave?: any;\n  extra?: VNode | string;\n  'aria-label'?: AriaAttributes['aria-label'];\n  role?: any; // a11y: wrapper role\n  tabIndex?: number; // a11y: wrapper tabIndex\n  addonId?: string;\n  extraId?: string;\n  type?: CheckboxType;\n  index?: number;\n  class?: string;\n}\n\ninterface CheckboxState {\n  checked: boolean;\n  addonId?: string;\n  extraId?: string;\n  focusVisible?: boolean;\n}\n\nconst defaultProps = {\n  defaultChecked: false,\n  indeterminate: false,\n  onChange: noop,\n  onMouseEnter: noop,\n  onMouseLeave: noop,\n  type: 'default',\n};\nexport const vuePropsType = vuePropsMake<CheckboxProps>(propTypesCheckbox, defaultProps);\nconst Checkbox = defineComponent({\n  props: { ...vuePropsType },\n  name: 'Checkbox',\n  setup(props, {}) {\n    const { getProps } = useHasInProps();\n    const slots = useSlots();\n\n    const checked = false;\n    const state = reactive<CheckboxState>({\n      checked: props.checked || props.defaultChecked || checked,\n      addonId: props.addonId,\n      extraId: props.extraId,\n      focusVisible: false,\n    });\n    const checkboxEntity = ref(null);\n    const { adapter: adapterInject, getDataAttr } = useBaseComponent<CheckboxProps>(props, state);\n\n    const { context } = useCheckboxContext();\n\n    function adapter(): CheckboxAdapter<CheckboxProps, CheckboxState> {\n      return {\n        ...adapterInject<CheckboxProps, CheckboxState>(),\n        setNativeControlChecked: (checked) => {\n          state.checked = checked;\n        },\n        notifyChange: (cbContent) => {\n          const { onChange } = props;\n          onChange && onChange(cbContent);\n        },\n\n        generateEvent: (checked, e) => {\n          const cbValue = {\n            target: {\n              ...props,\n              checked,\n            },\n            stopPropagation: () => {\n              e.stopPropagation();\n            },\n            preventDefault: () => {\n              e.preventDefault();\n            },\n            nativeEvent: {\n              stopImmediatePropagation: () => {\n                if (e.nativeEvent && typeof e.nativeEvent.stopImmediatePropagation === 'function') {\n                  e.nativeEvent.stopImmediatePropagation();\n                }\n              },\n            },\n          };\n          return cbValue;\n        },\n        getIsInGroup: () => isInGroup(),\n        getGroupValue: () => (context && context.value.checkboxGroup.value) || [],\n        notifyGroupChange: (cbContent) => {\n          context.value.checkboxGroup.onChange(cbContent);\n        },\n        getGroupDisabled: () => context && context.value.checkboxGroup.disabled,\n        setAddonId: () => {\n          state.addonId = getUuidShort({ prefix: 'addon' });\n        },\n        setExtraId: () => {\n          state.extraId = getUuidShort({ prefix: 'extra' });\n        },\n        setFocusVisible: (focusVisible: boolean): void => {\n          state.focusVisible = focusVisible;\n        },\n        focusCheckboxEntity: () => {\n          focus();\n        },\n      };\n    }\n\n    const foundation = new CheckboxFoundation(adapter());\n\n    watch(\n      () => props.checked,\n      () => {\n        if (isUndefined(props.checked)) {\n          foundation.setChecked(false);\n        } else if (isBoolean(props.checked)) {\n          foundation.setChecked(props.checked);\n        }\n      }\n    );\n\n    function isInGroup(): boolean {\n      // Why do we need to determine whether there is a value in props?\n      // If there is no value in the props of the checkbox in the context of the checkboxGroup,\n      // it will be considered not to belong to the checkboxGroupã€‚\n      return Boolean(context && context.value.checkboxGroup && 'value' in getProps(props));\n    }\n\n    function focus() {\n      checkboxEntity.value && checkboxEntity.value.focus();\n    }\n\n    function blur() {\n      checkboxEntity.value && checkboxEntity.value.blur();\n    }\n\n    const handleChange: any = (e) => foundation.handleChange(e);\n\n    const handleEnterPress = (e: any) => foundation.handleEnterPress(e);\n\n    const handleFocusVisible = (event: FocusEvent) => {\n      foundation.handleFocusVisible(event);\n    };\n\n    const handleBlur = (event: FocusEvent) => {\n      foundation.handleBlur();\n    };\n\n    return () => {\n      const children = slots.default ? slots.default() : null;\n      const {\n        disabled,\n        style,\n        prefixCls,\n        className,\n        indeterminate,\n        onMouseEnter,\n        onMouseLeave,\n        extra,\n        value,\n        role,\n        tabIndex,\n        id,\n        type,\n      } = props;\n      const { checked, addonId, extraId, focusVisible } = state;\n      const props_: Record<string, any> = {\n        checked,\n        disabled,\n      };\n\n      const inGroup = isInGroup();\n      if (inGroup) {\n        if (context.value.checkboxGroup.value) {\n          const realChecked = (context.value.checkboxGroup.value || []).includes(value);\n          props_.checked = realChecked;\n        }\n        if (context.value.checkboxGroup.disabled) {\n          props_.disabled = context.value.checkboxGroup.disabled || props.disabled;\n        }\n        const { isCardType, isPureCardType } = context.value.checkboxGroup;\n        props_.isCardType = isCardType;\n        props_.isPureCardType = isPureCardType;\n      } else {\n        props_.isPureCardType = type === strings.TYPE_PURECARD;\n        props_.isCardType = type === strings.TYPE_CARD || props_.isPureCardType;\n      }\n\n      const prefix = prefixCls || css.PREFIX;\n\n      const focusOuter = props_.isCardType || props_.isPureCardType;\n      const wrapper = classnames(prefix, {\n        [`${prefix}-disabled`]: props_.disabled,\n        [`${prefix}-indeterminate`]: indeterminate,\n        [`${prefix}-checked`]: props_.checked,\n        [`${prefix}-unChecked`]: !props_.checked,\n        [`${prefix}-cardType`]: props_.isCardType,\n        [`${prefix}-cardType_disabled`]: props_.disabled && props_.isCardType,\n        [`${prefix}-cardType_enable`]: !(props_.disabled && props_.isCardType),\n        [`${prefix}-cardType_checked`]: props_.isCardType && props_.checked && !props_.disabled,\n        [`${prefix}-cardType_checked_disabled`]: props_.isCardType && props_.checked && props_.disabled,\n        [className]: Boolean(className),\n        [`${prefix}-focus`]: focusVisible && focusOuter,\n      });\n\n      const extraCls = classnames(`${prefix}-extra`, {\n        [`${prefix}-cardType_extra_noChildren`]: props_.isCardType && !children,\n      });\n\n      const name = inGroup ? context.value.checkboxGroup.name : undefined;\n      const xSemiPropChildren = props['x-semi-children-alias'] || 'children';\n\n      const renderContent = () => {\n        if (!children && !extra) {\n          return null;\n        }\n\n        return (\n          <div class={`${prefix}-content`}>\n            {children ? (\n              <span id={addonId} class={`${prefix}-addon`} x-semi-prop={xSemiPropChildren}>\n                {children}\n              </span>\n            ) : null}\n            {extra ? (\n              <div id={extraId} class={extraCls} x-semi-prop=\"extra\">\n                {extra}\n              </div>\n            ) : null}\n          </div>\n        );\n      };\n      return (\n        // label is better than span, however span is here which is to solve gitlab issue #364\n        // eslint-disable-next-line jsx-a11y/click-events-have-key-events,jsx-a11y/no-static-element-interactions\n        <span\n          role={role}\n          tabindex={tabIndex}\n          style={style}\n          class={wrapper}\n          id={id}\n          onMouseenter={onMouseEnter}\n          onMouseleave={onMouseLeave}\n          onClick={handleChange}\n          onKeypress={handleEnterPress}\n          aria-labelledby={props['aria-labelledby']}\n          {...getDataAttr()}\n        >\n          <CheckboxInner\n            {...{\n              ...props,\n              ...props_,\n              addonId: children && addonId,\n              extraId: extra && extraId,\n              isPureCardType: props_.isPureCardType,\n              ref: checkboxEntity,\n              focusInner: focusVisible && !focusOuter,\n              onInputFocus: handleFocusVisible,\n              onInputBlur: handleBlur,\n            }}\n          />\n          {renderContent()}\n        </span>\n      );\n    };\n  },\n});\n\nexport default Checkbox;\n"],"names":["defaultProps","defaultChecked","indeterminate","onChange","noop","onMouseEnter","onMouseLeave","type","vuePropsType","vuePropsMake","propTypesCheckbox","Checkbox","defineComponent","props","name","setup","getProps","useHasInProps","slots","useSlots","state","reactive","checked","addonId","extraId","focusVisible","checkboxEntity","ref","adapter","adapterInject","getDataAttr","useBaseComponent","context","useCheckboxContext","setNativeControlChecked","notifyChange","cbContent","generateEvent","e","target","stopPropagation","preventDefault","nativeEvent","stopImmediatePropagation","getIsInGroup","isInGroup","getGroupValue","value","checkboxGroup","notifyGroupChange","getGroupDisabled","disabled","setAddonId","getUuidShort","prefix","setExtraId","setFocusVisible","focusCheckboxEntity","focus","foundation","CheckboxFoundation","watch","isUndefined","setChecked","isBoolean","Boolean","handleChange","handleEnterPress","handleFocusVisible","event","handleBlur","children","default","style","prefixCls","className","extra","role","tabIndex","id","props_","inGroup","realChecked","includes","isCardType","isPureCardType","strings","TYPE_PURECARD","TYPE_CARD","css","PREFIX","focusOuter","wrapper","classnames","extraCls","xSemiPropChildren","renderContent","_createVNode","_mergeProps","CheckboxInner","focusInner","onInputFocus","onInputBlur"],"mappings":"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"}