{"version":3,"file":"index.js","sources":["../../src/components/_cssAnimation/index.tsx"],"sourcesContent":["import { isEqual, noop } from 'lodash';\nimport {\n  ComponentObjectPropsOptions,\n  CSSProperties,\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  PropType,\n  reactive,\n  useSlots,\n  VNode,\n  watch,\n} from 'vue';\nimport { CombineProps, VueJsxNode } from '../interface';\nimport * as PropTypes from '../PropTypes';\n\ninterface AnimationEventsNeedBind {\n  onAnimationStart?: (e: AnimationEvent) => void;\n  onAnimationEnd?: (e: AnimationEvent) => void;\n\n  [key: string]: (e: any) => void;\n}\n\ninterface AnimationProps {\n  startClassName?: string;\n  endClassName?: string;\n  children: ({}: {\n    animationClassName: string;\n    animationStyle: CSSProperties;\n    animationEventsNeedBind: AnimationEventsNeedBind;\n    isAnimating: boolean;\n  }) => VueJsxNode;\n  animationState: 'enter' | 'leave';\n  onAnimationEnd?: (stoppedByAnother: boolean) => void;\n  onAnimationStart?: () => void;\n  motion?: boolean;\n  replayKey?: string;\n  fillMode?: 'backwards' | 'both' | 'forwards' | 'none';\n}\n\ninterface AnimationState {\n  currentClassName: string;\n  extraStyle: CSSProperties;\n  isAnimating: boolean;\n}\n\nexport const vuePropsType: CombineProps<AnimationProps> = {\n  startClassName: String,\n  endClassName: String,\n  children: {\n    type: [Function, Object] as PropType<AnimationProps['children']>,\n    required: true,\n  },\n  animationState: {\n    type: String as PropType<AnimationProps['animationState']>,\n    required: true,\n  },\n  onAnimationEnd: Function as PropType<AnimationProps['onAnimationEnd']>,\n  onAnimationStart: Function as PropType<AnimationProps['onAnimationStart']>,\n  motion: {\n    type: [PropTypes.bool, PropTypes.func, PropTypes.object] as PropType<AnimationProps['motion']>,\n    default: true,\n  },\n  replayKey: {\n    type: String,\n    default: '',\n  },\n  fillMode: String as PropType<AnimationProps['fillMode']>,\n};\n\nconst CSSAnimation = defineComponent({\n  props: { ...vuePropsType },\n  name: 'CSSAnimation',\n  setup(props, {}) {\n    const slots = useSlots();\n\n    const state = reactive<AnimationState>({\n      currentClassName: props.startClassName,\n      extraStyle: {\n        animationFillMode: props.fillMode,\n      },\n      isAnimating: true,\n    });\n\n    onMounted(() => {\n      props.onAnimationStart?.();\n      if (!props.motion) {\n        props.onAnimationEnd?.(false);\n        state.isAnimating = false;\n      }\n    });\n    // TODO watch的“value, oldValue”就算实际变了得到的值可能还是相同的\n    watch(\n      () => props.animationState,\n      () => {\n        // if (changedKeys.includes(\"animationState\")) {\n        // }\n      }\n    );\n    watch([() => props.startClassName, () => props.replayKey, () => props.motion], () => {\n      state.currentClassName = props.startClassName;\n      state.extraStyle = {\n        animationFillMode: props.fillMode,\n      };\n      state.isAnimating = true;\n      nextTick(() => {\n        props.onAnimationStart?.();\n        if (!props.motion) {\n          props.onAnimationEnd?.(state.isAnimating);\n          state.isAnimating = false;\n        }\n      });\n    });\n\n    const handleAnimationStart = () => {\n      props.onAnimationStart?.();\n    };\n\n    const handleAnimationEnd = () => {\n      state.currentClassName = props.startClassName;\n      state.extraStyle = {\n        animationFillMode: props.fillMode,\n      };\n      state.isAnimating = false;\n      nextTick(() => {\n        props.onAnimationEnd?.(false);\n      });\n    };\n    return () => {\n      if (props.motion) {\n        return props.children({\n          animationClassName: state.currentClassName ?? '',\n          animationStyle: state.extraStyle,\n          animationEventsNeedBind: {\n            onAnimationstart: handleAnimationStart,\n            onAnimationend: handleAnimationEnd,\n          },\n          isAnimating: state.isAnimating,\n        }) as VNode;\n      } else {\n        return props.children({\n          animationClassName: '',\n          animationStyle: {},\n          animationEventsNeedBind: {},\n          isAnimating: state.isAnimating,\n        }) as VNode;\n      }\n    };\n  },\n});\n\nexport default CSSAnimation;\n"],"names":["vuePropsType","startClassName","String","endClassName","children","type","Function","Object","required","animationState","onAnimationEnd","onAnimationStart","motion","PropTypes","bool","func","object","default","replayKey","fillMode","CSSAnimation","defineComponent","props","name","setup","useSlots","state","reactive","currentClassName","extraStyle","animationFillMode","isAnimating","onMounted","watch","nextTick","handleAnimationStart","handleAnimationEnd","animationClassName","animationStyle","animationEventsNeedBind","onAnimationstart","onAnimationend"],"mappings":";;AA+CO,MAAMA,IAA6C;AAAA,EACxDC,gBAAgBC;AAAAA,EAChBC,cAAcD;AAAAA,EACdE,UAAU;AAAA,IACRC,MAAM,CAACC,UAAUC,MAAM;AAAA,IACvBC,UAAU;AAAA,EACX;AAAA,EACDC,gBAAgB;AAAA,IACdJ,MAAMH;AAAAA,IACNM,UAAU;AAAA,EACX;AAAA,EACDE,gBAAgBJ;AAAAA,EAChBK,kBAAkBL;AAAAA,EAClBM,QAAQ;AAAA,IACNP,MAAM,CAACQ,EAAUC,MAAMD,EAAUE,MAAMF,EAAUG,MAAM;AAAA,IACvDC,SAAS;AAAA,EACV;AAAA,EACDC,WAAW;AAAA,IACTb,MAAMH;AAAAA,IACNe,SAAS;AAAA,EACV;AAAA,EACDE,UAAUjB;AACZ,GAEMkB,IAAeC,gBAAAA,EAAgB;AAAA,EACnCC,OAAO;AAAA,IAAE,GAAGtB;AAAAA,EAAc;AAAA,EAC1BuB,MAAM;AAAA,EACNC,MAAMF,GAAO,IAAI;AACDG,IAAAA,EAAU;AAExB,UAAMC,IAAQC,EAAyB;AAAA,MACrCC,kBAAkBN,EAAMrB;AAAAA,MACxB4B,YAAY;AAAA,QACVC,mBAAmBR,EAAMH;AAAAA,MAC1B;AAAA,MACDY,aAAa;AAAA,IACf,CAAC;AAEDC,IAAAA,EAAU,MAAM;;AACdV,OAAAA,IAAAA,EAAMX,qBAANW,QAAAA,EAAAA,KAAAA,IACKA,EAAMV,YACTU,IAAAA,EAAMZ,mBAANY,QAAAA,EAAAA,KAAAA,GAAuB,KACvBI,EAAMK,cAAc;AAAA,IAExB,CAAC,GAEDE,EACE,MAAMX,EAAMb,gBACZ,MAAM;AAAA,IAEJ,CAEJ,GACAwB,EAAM,CAAC,MAAMX,EAAMrB,gBAAgB,MAAMqB,EAAMJ,WAAW,MAAMI,EAAMV,MAAM,GAAG,MAAM;AACnFc,MAAAA,EAAME,mBAAmBN,EAAMrB,gBAC/ByB,EAAMG,aAAa;AAAA,QACjBC,mBAAmBR,EAAMH;AAAAA,SAE3BO,EAAMK,cAAc,IACpBG,EAAS,MAAM;;AACbZ,SAAAA,IAAAA,EAAMX,qBAANW,QAAAA,EAAAA,KAAAA,IACKA,EAAMV,YACTU,IAAAA,EAAMZ,mBAANY,QAAAA,EAAAA,KAAAA,GAAuBI,EAAMK,cAC7BL,EAAMK,cAAc;AAAA,MAExB,CAAC;AAAA,IACH,CAAC;AAED,UAAMI,IAAuBA,MAAM;;AACjCb,OAAAA,IAAAA,EAAMX,qBAANW,QAAAA,EAAAA,KAAAA;AAAAA,OAGIc,IAAqBA,MAAM;AAC/BV,MAAAA,EAAME,mBAAmBN,EAAMrB,gBAC/ByB,EAAMG,aAAa;AAAA,QACjBC,mBAAmBR,EAAMH;AAAAA,SAE3BO,EAAMK,cAAc,IACpBG,EAAS,MAAM;;AACbZ,SAAAA,IAAAA,EAAMZ,mBAANY,QAAAA,EAAAA,KAAAA,GAAuB;AAAA,MACzB,CAAC;AAAA;AAEH,WAAO,MACDA,EAAMV,SACDU,EAAMlB,SAAS;AAAA,MACpBiC,oBAAoBX,EAAME,oBAAoB;AAAA,MAC9CU,gBAAgBZ,EAAMG;AAAAA,MACtBU,yBAAyB;AAAA,QACvBC,kBAAkBL;AAAAA,QAClBM,gBAAgBL;AAAAA,MACjB;AAAA,MACDL,aAAaL,EAAMK;AAAAA,IACrB,CAAC,IAEMT,EAAMlB,SAAS;AAAA,MACpBiC,oBAAoB;AAAA,MACpBC,gBAAgB,CAAE;AAAA,MAClBC,yBAAyB,CAAE;AAAA,MAC3BR,aAAaL,EAAMK;AAAAA,IACrB,CAAC;AAAA,EAGP;AACF,CAAC;"}