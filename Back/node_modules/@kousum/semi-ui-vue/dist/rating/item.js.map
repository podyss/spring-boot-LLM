{"version":3,"file":"item.js","sources":["../../src/components/rating/item.tsx"],"sourcesContent":["import cls from 'classnames';\nimport * as PropTypes from '../PropTypes';\nimport { cssClasses, strings } from '@douyinfe/semi-foundation/rating/constants';\nimport '@douyinfe/semi-foundation/rating/rating.scss';\nimport { IconStar } from '@kousum/semi-icons-vue';\nimport { RatingItemFoundation, RatingItemAdapter } from '@douyinfe/semi-foundation/rating/foundation';\nimport { BaseProps, useBaseComponent } from '../_base/baseComponent';\nimport { ComponentObjectPropsOptions, defineComponent, h, PropType, reactive, ref, useSlots } from 'vue';\nimport { CombineProps, VueHTMLAttributes, VueJsxNode } from '../interface';\nimport { AriaAttributes } from '../AriaAttributes';\nimport { vuePropsMake } from '../PropTypes';\n\ntype ArrayElement<ArrayType extends readonly unknown[]> = ArrayType extends readonly (infer ElementType)[]\n  ? ElementType\n  : never;\n\nexport interface RatingItemProps extends BaseProps {\n  value: number;\n  index: number;\n  prefixCls: string;\n  allowHalf: boolean;\n  onHover: (e: MouseEvent, index: number) => void;\n  onClick: (e: MouseEvent | KeyboardEvent, index: number) => void;\n  character: VueJsxNode;\n  focused: boolean;\n  disabled: boolean;\n  count: number;\n  ariaLabelPrefix: string;\n  size: number | ArrayElement<typeof strings.SIZE_SET>;\n  'aria-describedby'?: AriaAttributes['aria-describedby'];\n  onFocus?: (e: FocusEvent) => void;\n  onBlur?: (e: FocusEvent) => void;\n  preventScroll?: boolean;\n}\n\nexport interface RatingItemState {\n  firstStarFocus: boolean;\n  secondStarFocus: boolean;\n}\n\nconst propTypes: CombineProps<RatingItemProps> = {\n  value: {\n    type: PropTypes.number,\n    required: true\n  },\n  index: {\n    type: PropTypes.number,\n    required: true\n  },\n  prefixCls: {\n    type: PropTypes.string,\n    required: true\n  },\n  allowHalf: {\n    type: PropTypes.bool,\n    required: true\n  },\n  onHover: {\n    type: PropTypes.func as PropType<RatingItemProps['onHover']>,\n    required: true\n  },\n  onClick: {\n    type: PropTypes.func as PropType<RatingItemProps['onClick']>,\n    required: true\n  },\n  character: {\n    type: PropTypes.node,\n    required: true\n  },\n  focused: {\n    type: PropTypes.bool,\n    required: true\n  },\n  disabled: {\n    type: PropTypes.bool,\n    required: true\n  },\n  count: {\n    type: PropTypes.number,\n    required: true\n  },\n  ariaLabelPrefix: {\n    type: PropTypes.string,\n    required: true\n  },\n  size: {\n    type: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    required: true\n  },\n  'aria-describedby': PropTypes.string,\n  onFocus: PropTypes.func as PropType<RatingItemProps['onFocus']>,\n  onBlur: PropTypes.func as PropType<RatingItemProps['onBlur']>,\n  preventScroll: PropTypes.bool,\n  style: PropTypes.object,\n  className: PropTypes.string,\n};\nexport const vuePropsType = vuePropsMake<RatingItemProps>(propTypes, {});\nconst Item = defineComponent({\n  props: { ...vuePropsType },\n  name: 'Item',\n  setup(props, { expose }) {\n    const slots = useSlots();\n\n    const state = reactive<RatingItemState>({\n      firstStarFocus: false,\n      secondStarFocus: false,\n    });\n\n    const { adapter: adapterInject } = useBaseComponent<RatingItemProps>(props, state);\n    function adapter_(): RatingItemAdapter<RatingItemProps, RatingItemState> {\n      return {\n        ...adapterInject<RatingItemProps, RatingItemState>(),\n        setFirstStarFocus: (value) => {\n          state.firstStarFocus = value;\n        },\n        setSecondStarFocus: (value) => {\n          state.secondStarFocus = value;\n        },\n      };\n    }\n    const adapter = adapter_();\n    const foundation = new RatingItemFoundation(adapter);\n\n    const firstStar = ref();\n    const secondStar = ref();\n\n    const onHover = (e) => {\n      const { onHover, index } = props;\n      onHover(e, index);\n    };\n\n    const onClick = (e) => {\n      const { onClick, index } = props;\n      onClick(e, index);\n    };\n\n    const onFocus = (e, star) => {\n      const { onFocus } = props;\n      onFocus && onFocus(e);\n      foundation.handleFocusVisible(e, star);\n    };\n\n    const onBlur = (e, star) => {\n      const { onBlur } = props;\n      onBlur && onBlur(e);\n      foundation.handleBlur(e, star);\n    };\n\n    const onKeyDown = (e) => {\n      const { onClick, index } = props;\n      if (e.keyCode === 13) {\n        onClick(e, index);\n      }\n    };\n\n    const starFocus = () => {\n      const { value, index, preventScroll } = props;\n      if (value - index === 0.5) {\n        firstStar.value.focus({ preventScroll });\n      } else {\n        secondStar.value.focus({ preventScroll });\n      }\n    };\n\n    expose({\n      starFocus,\n    });\n\n    return () => {\n      const { index, prefixCls, character, count, value, disabled, allowHalf, focused, size, ariaLabelPrefix } = props;\n      const { firstStarFocus, secondStarFocus } = state;\n      const starValue = index + 1;\n      const diff = starValue - value;\n      // const isHalf = allowHalf && value + 0.5 === starValue;\n      const isHalf = allowHalf && diff < 1 && diff > 0;\n      const firstWidth = 1 - diff;\n      const isFull = starValue <= value;\n      const isCustomSize = typeof size === 'number';\n      const starCls = cls(prefixCls, {\n        [`${prefixCls}-half`]: isHalf,\n        [`${prefixCls}-full`]: isFull,\n        [`${prefixCls}-${size}`]: !isCustomSize,\n      });\n      const sizeStyle = isCustomSize\n        ? {\n            width: size,\n            height: size,\n            fontSize: size,\n          }\n        : {};\n      const iconSize = isCustomSize ? 'inherit' : size === 'small' ? 'default' : 'extra-large';\n      const content = character ? character : <IconStar size={iconSize} style={{ display: 'block' }} />;\n      const isEmpty = index === count;\n      const starWrapCls = cls(`${prefixCls}-wrapper`, {\n        [`${prefixCls}-disabled`]: disabled,\n        [`${cssClasses.PREFIX}-focus`]: (firstStarFocus || secondStarFocus) && value !== 0,\n      });\n      const starWrapProps: VueHTMLAttributes = {\n        onClick: disabled ? null : onClick,\n        onKeydown: disabled ? null : onKeyDown,\n        onMousemove: disabled ? null : onHover,\n        class: starWrapCls,\n      };\n      const AriaSetSize = allowHalf ? count * 2 + 1 : count + 1;\n      const firstStarProps: VueHTMLAttributes = {\n        ref: firstStar as any,\n        role: 'radio',\n        'aria-checked': value === index + 0.5,\n        'aria-posinset': 2 * index + 1,\n        'aria-setsize': AriaSetSize,\n        'aria-disabled': disabled,\n        'aria-label': `${index + 0.5} ${ariaLabelPrefix}s`,\n        'aria-labelledby': props['aria-describedby'],\n        'aria-describedby': props['aria-describedby'],\n        class: cls(`${prefixCls}-first`, `${cssClasses.PREFIX}-no-focus`),\n        tabindex: !disabled && value === index + 0.5 ? 0 : -1,\n        onFocus: (e) => {\n          onFocus(e, 'first');\n        },\n        onBlur: (e) => {\n          onBlur(e, 'first');\n        },\n      };\n\n      const secondStarTabIndex = !disabled && (value === index + 1 || (isEmpty && value === 0)) ? 0 : -1;\n      const secondStarProps = {\n        ref: secondStar as any,\n        role: 'radio',\n        'aria-checked': isEmpty ? value === 0 : value === index + 1,\n        'aria-posinset': allowHalf ? 2 * (index + 1) : index + 1,\n        'aria-setsize': AriaSetSize,\n        'aria-disabled': disabled,\n        'aria-label': `${isEmpty ? 0 : index + 1} ${ariaLabelPrefix}${index === 0 ? '' : 's'}`,\n        'aria-labelledby': props['aria-describedby'],\n        'aria-describedby': props['aria-describedby'],\n        className: cls(`${prefixCls}-second`, `${cssClasses.PREFIX}-no-focus`),\n        tabIndex: secondStarTabIndex,\n        onFocus: (e) => {\n          onFocus(e, 'second');\n        },\n        onBlur: (e) => {\n          onBlur(e, 'second');\n        },\n      };\n\n      return (\n        <li class={starCls} style={{ ...sizeStyle }} key={index}>\n          <div {...(starWrapProps as any)}>\n            {allowHalf && !isEmpty && (\n              <div {...firstStarProps} style={{ width: `${firstWidth * 100}%` }}>\n                {content}\n              </div>\n            )}\n            <div {...secondStarProps} x-semi-prop=\"character\">\n              {content}\n            </div>\n          </div>\n        </li>\n      );\n    };\n  },\n});\n\nexport default Item;\n"],"names":["propTypes","value","type","PropTypes","number","required","index","prefixCls","string","allowHalf","bool","onHover","func","onClick","character","node","focused","disabled","count","ariaLabelPrefix","size","oneOfType","onFocus","onBlur","preventScroll","style","object","className","vuePropsType","vuePropsMake","Item","defineComponent","props","name","setup","expose","useSlots","state","reactive","firstStarFocus","secondStarFocus","adapter","adapterInject","useBaseComponent","adapter_","setFirstStarFocus","setSecondStarFocus","foundation","RatingItemFoundation","firstStar","ref","secondStar","e","star","handleFocusVisible","handleBlur","onKeyDown","keyCode","starFocus","focus","starValue","diff","isHalf","firstWidth","isFull","isCustomSize","starCls","cls","sizeStyle","width","height","fontSize","content","_createVNode","IconStar","display","isEmpty","starWrapCls","cssClasses","PREFIX","starWrapProps","onKeydown","onMousemove","class","AriaSetSize","firstStarProps","role","tabindex","secondStarTabIndex","secondStarProps","tabIndex","_mergeProps"],"mappings":";;;;;;;;;AAwCA,MAAMA,KAA2C;AAAA,EAC/CC,OAAO;AAAA,IACLC,MAAMC,EAAUC;AAAAA,IAChBC,UAAU;AAAA,EACX;AAAA,EACDC,OAAO;AAAA,IACLJ,MAAMC,EAAUC;AAAAA,IAChBC,UAAU;AAAA,EACX;AAAA,EACDE,WAAW;AAAA,IACTL,MAAMC,EAAUK;AAAAA,IAChBH,UAAU;AAAA,EACX;AAAA,EACDI,WAAW;AAAA,IACTP,MAAMC,EAAUO;AAAAA,IAChBL,UAAU;AAAA,EACX;AAAA,EACDM,SAAS;AAAA,IACPT,MAAMC,EAAUS;AAAAA,IAChBP,UAAU;AAAA,EACX;AAAA,EACDQ,SAAS;AAAA,IACPX,MAAMC,EAAUS;AAAAA,IAChBP,UAAU;AAAA,EACX;AAAA,EACDS,WAAW;AAAA,IACTZ,MAAMC,EAAUY;AAAAA,IAChBV,UAAU;AAAA,EACX;AAAA,EACDW,SAAS;AAAA,IACPd,MAAMC,EAAUO;AAAAA,IAChBL,UAAU;AAAA,EACX;AAAA,EACDY,UAAU;AAAA,IACRf,MAAMC,EAAUO;AAAAA,IAChBL,UAAU;AAAA,EACX;AAAA,EACDa,OAAO;AAAA,IACLhB,MAAMC,EAAUC;AAAAA,IAChBC,UAAU;AAAA,EACX;AAAA,EACDc,iBAAiB;AAAA,IACfjB,MAAMC,EAAUK;AAAAA,IAChBH,UAAU;AAAA,EACX;AAAA,EACDe,MAAM;AAAA,IACJlB,MAAMC,EAAUkB,UAAU,CAAClB,EAAUK,QAAQL,EAAUC,MAAM,CAAC;AAAA,IAC9DC,UAAU;AAAA,EACX;AAAA,EACD,oBAAoBF,EAAUK;AAAAA,EAC9Bc,SAASnB,EAAUS;AAAAA,EACnBW,QAAQpB,EAAUS;AAAAA,EAClBY,eAAerB,EAAUO;AAAAA,EACzBe,OAAOtB,EAAUuB;AAAAA,EACjBC,WAAWxB,EAAUK;AACvB,GACaoB,KAAeC,EAA8B7B,IAAW,EAAE,GACjE8B,KAAOC,gBAAAA,EAAgB;AAAA,EAC3BC,OAAO;AAAA,IAAE,GAAGJ;AAAAA,EAAc;AAAA,EAC1BK,MAAM;AAAA,EACNC,MAAMF,GAAO;AAAA,IAAEG,QAAAA;AAAAA,EAAO,GAAG;AACTC,IAAAA,EAAU;AAExB,UAAMC,IAAQC,EAA0B;AAAA,MACtCC,gBAAgB;AAAA,MAChBC,iBAAiB;AAAA,IACnB,CAAC,GAEK;AAAA,MAAEC,SAASC;AAAAA,IAAc,IAAIC,GAAkCX,GAAOK,CAAK;AACjF,aAASO,IAAgE;AACvE,aAAO;AAAA,QACL,GAAGF,EAAiD;AAAA,QACpDG,mBAAoB5C,CAAAA,MAAU;AAC5BoC,UAAAA,EAAME,iBAAiBtC;AAAAA,QACxB;AAAA,QACD6C,oBAAqB7C,CAAAA,MAAU;AAC7BoC,UAAAA,EAAMG,kBAAkBvC;AAAAA,QAC1B;AAAA;IAEJ;AACA,UAAMwC,IAAUG,KACVG,IAAa,IAAIC,EAAqBP,CAAO,GAE7CQ,IAAYC,KACZC,IAAaD,KAEbvC,IAAWyC,OAAM;AACrB,YAAM;AAAA,QAAEzC,SAAAA;AAAAA,QAASL,OAAAA;AAAAA,MAAO,IAAG0B;AAC3BrB,MAAAA,EAAQyC,GAAG9C,CAAK;AAAA,OAGZO,IAAWuC,OAAM;AACrB,YAAM;AAAA,QAAEvC,SAAAA;AAAAA,QAASP,OAAAA;AAAAA,MAAO,IAAG0B;AAC3BnB,MAAAA,EAAQuC,GAAG9C,CAAK;AAAA,OAGZgB,IAAUA,CAAC8B,GAAGC,MAAS;AAC3B,YAAM;AAAA,QAAE/B,SAAAA;AAAAA,MAAS,IAAGU;AACpBV,MAAAA,KAAWA,EAAQ8B,CAAC,GACpBL,EAAWO,mBAAmBF,GAAGC,CAAI;AAAA,OAGjC9B,IAASA,CAAC6B,GAAGC,MAAS;AAC1B,YAAM;AAAA,QAAE9B,QAAAA;AAAAA,MAAQ,IAAGS;AACnBT,MAAAA,KAAUA,EAAO6B,CAAC,GAClBL,EAAWQ,WAAWH,GAAGC,CAAI;AAAA,OAGzBG,IAAaJ,OAAM;AACvB,YAAM;AAAA,QAAEvC,SAAAA;AAAAA,QAASP,OAAAA;AAAAA,MAAO,IAAG0B;AAC3B,MAAIoB,EAAEK,YAAY,MAChB5C,EAAQuC,GAAG9C,CAAK;AAAA;AAapB6B,WAAAA,EAAO;AAAA,MACLuB,WAVgBA,MAAM;AACtB,cAAM;AAAA,UAAEzD,OAAAA;AAAAA,UAAOK,OAAAA;AAAAA,UAAOkB,eAAAA;AAAAA,QAAe,IAAGQ;AACxC,QAAI/B,IAAQK,MAAU,MACpB2C,EAAUhD,MAAM0D,MAAM;AAAA,UAAEnC,eAAAA;AAAAA,QAAc,CAAC,IAEvC2B,EAAWlD,MAAM0D,MAAM;AAAA,UAAEnC,eAAAA;AAAAA,QAAc,CAAC;AAAA;IAM5C,CAAC,GAEM,MAAM;AACX,YAAM;AAAA,QAAElB,OAAAA;AAAAA,QAAOC,WAAAA;AAAAA,QAAWO,WAAAA;AAAAA,QAAWI,OAAAA;AAAAA,QAAOjB,OAAAA;AAAAA,QAAOgB,UAAAA;AAAAA,QAAUR,WAAAA;AAAAA,QAAWO,SAAAA;AAAAA,QAASI,MAAAA;AAAAA,QAAMD,iBAAAA;AAAAA,MAAiB,IAAGa,GACrG;AAAA,QAAEO,gBAAAA;AAAAA,QAAgBC,iBAAAA;AAAAA,MAAiB,IAAGH,GACtCuB,IAAYtD,IAAQ,GACpBuD,IAAOD,IAAY3D,GAEnB6D,IAASrD,KAAaoD,IAAO,KAAKA,IAAO,GACzCE,IAAa,IAAIF,GACjBG,IAASJ,KAAa3D,GACtBgE,IAAe,OAAO7C,KAAS,UAC/B8C,IAAUC,EAAI5D,GAAW;AAAA,QAC7B,CAAC,GAAGA,CAAS,OAAO,GAAGuD;AAAAA,QACvB,CAAC,GAAGvD,CAAS,OAAO,GAAGyD;AAAAA,QACvB,CAAC,GAAGzD,CAAS,IAAIa,CAAI,EAAE,GAAG,CAAC6C;AAAAA,MAC7B,CAAC,GACKG,IAAYH,IACd;AAAA,QACEI,OAAOjD;AAAAA,QACPkD,QAAQlD;AAAAA,QACRmD,UAAUnD;AAAAA,MACX,IACD,IAEEoD,IAAU1D,KAAqB2D,EAAAC,GAAA;AAAA,QAAA,MADpBT,IAAe,YAAY7C,MAAS,UAAU,YAAY;AAAA,QACX,OAAS;AAAA,UAAEuD,SAAS;AAAA,QAAQ;AAAA,MAAK,GAAA,IAAA,GAC3FC,IAAUtE,MAAUY,GACpB2D,IAAcV,EAAI,GAAG5D,CAAS,YAAY;AAAA,QAC9C,CAAC,GAAGA,CAAS,WAAW,GAAGU;AAAAA,QAC3B,CAAC,GAAG6D,EAAWC,MAAM,QAAQ,IAAIxC,KAAkBC,MAAoBvC,MAAU;AAAA,MACnF,CAAC,GACK+E,IAAmC;AAAA,QACvCnE,SAASI,IAAW,OAAOJ;AAAAA,QAC3BoE,WAAWhE,IAAW,OAAOuC;AAAAA,QAC7B0B,aAAajE,IAAW,OAAON;AAAAA,QAC/BwE,OAAON;AAAAA,SAEHO,IAAc3E,IAAYS,IAAQ,IAAI,IAAIA,IAAQ,GAClDmE,IAAoC;AAAA,QACxCnC,KAAKD;AAAAA,QACLqC,MAAM;AAAA,QACN,gBAAgBrF,MAAUK,IAAQ;AAAA,QAClC,iBAAiB,IAAIA,IAAQ;AAAA,QAC7B,gBAAgB8E;AAAAA,QAChB,iBAAiBnE;AAAAA,QACjB,cAAc,GAAGX,IAAQ,GAAG,IAAIa,CAAe;AAAA,QAC/C,mBAAmBa,EAAM,kBAAkB;AAAA,QAC3C,oBAAoBA,EAAM,kBAAkB;AAAA,QAC5CmD,OAAOhB,EAAI,GAAG5D,CAAS,UAAU,GAAGuE,EAAWC,MAAM,WAAW;AAAA,QAChEQ,UAAU,CAACtE,KAAYhB,MAAUK,IAAQ,MAAM,IAAI;AAAA,QACnDgB,SAAU8B,CAAAA,MAAM;AACd9B,UAAAA,EAAQ8B,GAAG,OAAO;AAAA,QACnB;AAAA,QACD7B,QAAS6B,CAAAA,MAAM;AACb7B,UAAAA,EAAO6B,GAAG,OAAO;AAAA,QACnB;AAAA,SAGIoC,IAAqB,CAACvE,MAAahB,MAAUK,IAAQ,KAAMsE,KAAW3E,MAAU,KAAM,IAAI,IAC1FwF,IAAkB;AAAA,QACtBvC,KAAKC;AAAAA,QACLmC,MAAM;AAAA,QACN,gBAAgBV,IAAU3E,MAAU,IAAIA,MAAUK,IAAQ;AAAA,QAC1D,iBAAiBG,IAAY,KAAKH,IAAQ,KAAKA,IAAQ;AAAA,QACvD,gBAAgB8E;AAAAA,QAChB,iBAAiBnE;AAAAA,QACjB,cAAc,GAAG2D,IAAU,IAAItE,IAAQ,CAAC,IAAIa,CAAe,GAAGb,MAAU,IAAI,KAAK,GAAG;AAAA,QACpF,mBAAmB0B,EAAM,kBAAkB;AAAA,QAC3C,oBAAoBA,EAAM,kBAAkB;AAAA,QAC5CL,WAAWwC,EAAI,GAAG5D,CAAS,WAAW,GAAGuE,EAAWC,MAAM,WAAW;AAAA,QACrEW,UAAUF;AAAAA,QACVlE,SAAU8B,CAAAA,MAAM;AACd9B,UAAAA,EAAQ8B,GAAG,QAAQ;AAAA,QACpB;AAAA,QACD7B,QAAS6B,CAAAA,MAAM;AACb7B,UAAAA,EAAO6B,GAAG,QAAQ;AAAA,QACpB;AAAA;AAGF,aAAAqB,EAAA,MAAA;AAAA,QAAA,OACaP;AAAAA,QAAO,OAAS;AAAA,UAAE,GAAGE;AAAAA,QAAW;AAAA,QAAA,KAAO9D;AAAAA,MAAK,GAAA,CAAAmE,EAAA,OAC3CO,GAAa,CACpBvE,KAAa,CAACmE,KAAOH,EAAAkB,OAAAA,EACXN,GAAc;AAAA,QAAA,OAAS;AAAA,UAAEhB,OAAO,GAAGN,IAAa,GAAG;AAAA,QAAI;AAAA,MAAC,CAAA,GAAA,CAC9DS,CAAO,CAEX,GAAAC,EAAAkB,OAAAA,EACQF,GAAe;AAAA,QAAA,eAAA;AAAA,MAAA,CAAA,GAAA,CACrBjB,CAAO,CAAA,CAAA,CAAA,CAAA,CAAA;AAAA;EAMpB;AACF,CAAC;"}