{"version":3,"file":"previewInner.js","sources":["../../src/components/image/previewInner.tsx"],"sourcesContent":["import { PreviewInnerProps, PreviewInnerStates, RatioType, PreviewImageProps } from './interface';\nimport * as PropTypes from '../PropTypes';\nimport { cssClasses, numbers } from '@douyinfe/semi-foundation/image/constants';\nimport cls from 'classnames';\nimport { isEqual, isFunction } from 'lodash';\nimport Portal from '../_portal';\nimport { IconArrowLeft, IconArrowRight } from '@kousum/semi-icons-vue';\nimport Header from './previewHeader';\nimport Footer from './previewFooter';\nimport PreviewImage from './previewImage';\nimport PreviewInnerFoundation from '@douyinfe/semi-foundation/image/previewInnerFoundation';\nimport type { PreviewInnerAdapter } from '@douyinfe/semi-foundation/image/previewInnerFoundation';\nimport { getScrollbarWidth } from '../_utils';\n\nimport {\n  ComponentObjectPropsOptions,\n  CSSProperties,\n  defineComponent,\n  h,\n  onBeforeUnmount,\n  onMounted,\n  PropType,\n  reactive,\n  ref,\n  useSlots,\n  watch,\n} from 'vue';\nimport { vuePropsMake } from '../PropTypes';\nimport { usePreviewContext } from './previewContext/Consumer';\nimport { useBaseComponent, useHasInProps } from '../_base/baseComponent';\nimport { CombineProps } from '../interface';\n\nconst prefixCls = cssClasses.PREFIX;\n\nconst propTypes: CombineProps<PreviewInnerProps> = {\n  style: PropTypes.object,\n  className: PropTypes.string,\n  lazyLoadMargin: PropTypes.string,\n  visible: PropTypes.bool,\n  src: PropTypes.oneOfType([PropTypes.string, PropTypes.array]),\n  currentIndex: PropTypes.number,\n  defaultCurrentIndex: PropTypes.number,\n  defaultVisible: PropTypes.bool,\n  maskClosable: PropTypes.bool,\n  closable: PropTypes.bool,\n  zoomStep: PropTypes.number,\n  infinite: PropTypes.bool,\n  showTooltip: PropTypes.bool,\n  closeOnEsc: PropTypes.bool,\n  prevTip: PropTypes.string,\n  nextTip: PropTypes.string,\n  zoomInTip: PropTypes.string,\n  zoomOutTip: PropTypes.string,\n  downloadTip: PropTypes.string,\n  adaptiveTip: PropTypes.string,\n  originTip: PropTypes.string,\n  lazyLoad: PropTypes.bool,\n  preLoad: PropTypes.bool,\n  preLoadGap: PropTypes.number,\n  disableDownload: PropTypes.bool,\n  viewerVisibleDelay: PropTypes.number,\n  zIndex: PropTypes.number,\n  maxZoom: PropTypes.number as PropType<PreviewInnerProps['maxZoom']>,\n  minZoom: PropTypes.number,\n  renderHeader: PropTypes.func as PropType<PreviewInnerProps['renderHeader']>,\n  renderPreviewMenu: PropTypes.func as PropType<PreviewInnerProps['renderPreviewMenu']>,\n  getPopupContainer: PropTypes.func as PropType<PreviewInnerProps['getPopupContainer']>,\n  onVisibleChange: PropTypes.func as PropType<PreviewInnerProps['onVisibleChange']>,\n  onChange: PropTypes.func as PropType<PreviewInnerProps['onChange']>,\n  onClose: PropTypes.func as PropType<PreviewInnerProps['onClose']>,\n  onZoomIn: PropTypes.func as PropType<PreviewInnerProps['onZoomIn']>,\n  onZoomOut: PropTypes.func as PropType<PreviewInnerProps['onZoomOut']>,\n  onPrev: PropTypes.func as PropType<PreviewInnerProps['onPrev']>,\n  onNext: PropTypes.func as PropType<PreviewInnerProps['onNext']>,\n  onDownload: PropTypes.func as PropType<PreviewInnerProps['onDownload']>,\n  onRatioChange: PropTypes.func as PropType<PreviewInnerProps['onRatioChange']>,\n  onRotateChange: PropTypes.func as PropType<PreviewInnerProps['onRotateChange']>,\n  // onRotateLeft: PropTypes.func as PropType<PreviewInnerProps['onRotateLeft']>,\n\n  setDownloadName: PropTypes.func as PropType<PreviewInnerProps['setDownloadName']>,\n  crossOrigin: PropTypes.string as PropType<PreviewInnerProps['crossOrigin']>,\n  previewTitle: PropTypes.node as PropType<PreviewInnerProps['previewTitle']>,\n  rotateTip: PropTypes.string,\n  onRotateLeft: PropTypes.func as PropType<PreviewInnerProps['onRotateLeft']>,\n  onDownloadError: PropTypes.func as PropType<PreviewInnerProps['onDownloadError']>,\n  forwardRef: [PropTypes.func, PropTypes.object] as PropType<PreviewInnerProps['forwardRef']>,\n};\n\nconst defaultProps = {\n  showTooltip: false,\n  zoomStep: 0.1,\n  infinite: false,\n  closeOnEsc: true,\n  lazyLoad: false,\n  preLoad: true,\n  preLoadGap: 2,\n  zIndex: numbers.DEFAULT_Z_INDEX,\n  maskClosable: true,\n  viewerVisibleDelay: 10000,\n  maxZoom: 5,\n  minZoom: 0.1,\n};\nexport const vuePropsType = vuePropsMake<PreviewInnerProps>(propTypes, defaultProps);\nconst PreviewInner = defineComponent({\n  props: { ...vuePropsType },\n  name: 'PreviewInner',\n  setup(props, {}) {\n    const { getProps } = useHasInProps();\n    const slots = useSlots();\n\n    let bodyOverflow: string;\n    let scrollBarWidth: number;\n    let originBodyWidth: string;\n    const imageRef = ref()\n    const state = reactive<PreviewInnerStates>({\n      imgSrc: [],\n      imgLoadStatus: new Map(),\n      zoom: 0.1,\n      currentIndex: 0,\n      ratio: 'adaptation',\n      rotation: 0,\n      viewerVisible: true,\n      visible: false,\n      preloadAfterVisibleChange: true,\n      direction: '',\n    });\n    const { adapter: adapterInject } = useBaseComponent<PreviewInnerProps>(props, state);\n    const { context } = usePreviewContext();\n\n    const imageWrapRef = ref();\n    const headerRef = ref<HTMLElement>();\n    const footerRef = ref<HTMLElement>();\n    const leftIconRef = ref<HTMLDivElement>();\n    const rightIconRef = ref<HTMLDivElement>();\n    function adapter_(): PreviewInnerAdapter<PreviewInnerProps, PreviewInnerStates> {\n      return {\n        ...adapterInject(),\n        getIsInGroup: () => isInGroup(),\n        disabledBodyScroll: () => {\n          const { getPopupContainer } = props;\n          bodyOverflow = document.body.style.overflow || '';\n          if (!getPopupContainer && bodyOverflow !== 'hidden') {\n            document.body.style.overflow = 'hidden';\n            document.body.style.width = `calc(${originBodyWidth || '100%'} - ${scrollBarWidth}px)`;\n          }\n        },\n        enabledBodyScroll: () => {\n          const { getPopupContainer } = props;\n          if (!getPopupContainer && bodyOverflow !== 'hidden') {\n            document.body.style.overflow = bodyOverflow;\n            document.body.style.width = originBodyWidth;\n          }\n        },\n        notifyChange: (index: number, direction: string) => {\n          const { onChange, onPrev, onNext } = props;\n          isFunction(onChange) && onChange(index);\n          if (direction === 'prev') {\n            onPrev && onPrev(index);\n          } else {\n            onNext && onNext(index);\n          }\n        },\n        notifyZoom: (zoom: number, increase: boolean) => {\n          const { onZoomIn, onZoomOut } = props;\n          if (increase) {\n            isFunction(onZoomIn) && onZoomIn(zoom);\n          } else {\n            isFunction(onZoomOut) && onZoomOut(zoom);\n          }\n        },\n        notifyClose: () => {\n          const { onClose } = props;\n          isFunction(onClose) && onClose();\n        },\n        notifyVisibleChange: (visible: boolean) => {\n          const { onVisibleChange } = props;\n          isFunction(onVisibleChange) && onVisibleChange(visible);\n        },\n        notifyRatioChange: (type: string) => {\n          const { onRatioChange } = props;\n          isFunction(onRatioChange) && onRatioChange(type as 'adaptation' | 'realSize');\n        },\n        notifyRotateChange: (angle: number) => {\n          const { onRotateChange } = props;\n          isFunction(onRotateChange) && onRotateChange(angle);\n        },\n        notifyDownload: (src: string, index: number) => {\n          const { onDownload } = props;\n          isFunction(onDownload) && onDownload(src, index);\n        },\n        notifyDownloadError: (src: string) => {\n          const { onDownloadError } = props;\n          isFunction(onDownloadError) && onDownloadError(src);\n        },\n        registerKeyDownListener: () => {\n          window && window.addEventListener('keydown', handleKeyDown);\n        },\n        unregisterKeyDownListener: () => {\n          window && window.removeEventListener('keydown', handleKeyDown);\n        },\n        getSetDownloadFunc: () => {\n          return context.value?.setDownloadName ?? props.setDownloadName;\n        },\n        isValidTarget: (e) => {\n          const headerDom = headerRef.value;\n          const footerDom = footerRef.value;\n          const leftIconDom = leftIconRef.value;\n          const rightIconDom = rightIconRef.value;\n          const target = e.target as any;\n          if (\n            (headerDom && headerDom.contains(target)) ||\n            (footerDom && footerDom.contains(target)) ||\n            (leftIconDom && leftIconDom.contains(target)) ||\n            (rightIconDom && rightIconDom.contains(target))\n          ) {\n            // Move in the operation area, return false\n            return false;\n          }\n          // Move in the preview area except the operation area, return true\n          return true;\n        },\n        changeImageZoom: (...args) => {\n          imageRef?.value && imageRef.value.foundation.changeZoom(...args)\n        }\n      };\n    }\n\n    const adapter = adapter_();\n    const foundation = new PreviewInnerFoundation(adapter);\n\n    function getDerivedStateFromProps(props: PreviewInnerProps, state: PreviewInnerStates) {\n      const willUpdateStates: Partial<PreviewInnerStates> = {};\n      let src = [];\n      if (props.visible) {\n        // if src in props\n        src = Array.isArray(props.src) ? props.src : [props.src];\n      }\n      if (!isEqual(src, state.imgSrc)) {\n        willUpdateStates.imgSrc = src;\n      }\n      if (props.visible !== state.visible) {\n        willUpdateStates.visible = props.visible;\n        if (props.visible) {\n          willUpdateStates.preloadAfterVisibleChange = true;\n          willUpdateStates.viewerVisible = true;\n          willUpdateStates.rotation = 0;\n          willUpdateStates.ratio = 'adaptation';\n        }\n      }\n      if ('currentIndex' in getProps(props) && props.currentIndex !== state.currentIndex) {\n        willUpdateStates.currentIndex = props.currentIndex;\n        // ratio will set to adaptation when change picture,\n        // attention: If the ratio is controlled, the ratio should not change as the index changes\n        willUpdateStates.ratio = 'adaptation';\n      }\n      return willUpdateStates;\n    }\n\n    watch(\n      () => props,\n      (val) => {\n        const newState = getDerivedStateFromProps({ ...props }, { ...state });\n        if (newState) {\n          Object.keys(newState).forEach((key) => {\n            state[key] = newState[key];\n          });\n        }\n      },\n      { deep: true, immediate: true }\n    );\n\n    onMounted(() => {\n      scrollBarWidth = getScrollbarWidth();\n      originBodyWidth = document.body.style.width;\n      if (props.visible) {\n        foundation.beforeShow();\n      }\n    });\n\n    watch(\n      [() => state.visible, () => props.visible, () => props.src],\n      (value, [prevStateVisible, prevPropsVisible, prevPropsSrc], onCleanup) => {\n        if (prevPropsSrc !== props.src) {\n          foundation.updateTimer();\n        }\n        // hide => show\n        if (!prevStateVisible && props.visible) {\n          foundation.beforeShow();\n        }\n        // show => hide\n        if (prevStateVisible && !props.visible) {\n          foundation.afterHide();\n        }\n      },\n      { immediate: true }\n    );\n\n    onBeforeUnmount(() => {\n      foundation.clearTimer();\n    });\n\n    function isInGroup() {\n      return Boolean(context && context.value.isGroup);\n    }\n\n    function viewVisibleChange() {\n      foundation.handleViewVisibleChange();\n    }\n\n    const handleSwitchImage = (direction: string) => {\n      foundation.handleSwitchImage(direction);\n    };\n\n    const handleDownload = () => {\n      foundation.handleDownload();\n    };\n\n    const handlePreviewClose = (e: MouseEvent) => {\n      foundation.handlePreviewClose(e);\n    };\n\n    const handleAdjustRatio = (type: RatioType) => {\n      foundation.handleAdjustRatio(type);\n    };\n\n    const handleRotateImage = (direction) => {\n      foundation.handleRotateImage(direction);\n    };\n\n    const handleZoomImage = (newZoom: number, notify: boolean = true) => {\n      foundation.handleZoomImage(newZoom);\n    };\n\n    const handleMouseUp = (e): void => {\n      foundation.handleMouseUp(e);\n    };\n\n    const handleMouseMove = (e): void => {\n      foundation.handleMouseMove(e);\n    };\n\n    function handleKeyDown(e: KeyboardEvent) {\n      foundation.handleKeyDown(e);\n    }\n\n    function onImageError() {\n      foundation.preloadSingleImage();\n    }\n\n    function onImageLoad(src) {\n      foundation.onImageLoad(src);\n    }\n\n    function handleMouseDown(e): void {\n      foundation.handleMouseDown(e);\n    }\n\n    const handleWheel = (e) => {\n      foundation.handleWheel(e);\n    };\n\n    // 为什么通过 addEventListener 注册 wheel 事件而不是使用 onWheel 事件？\n    // 因为 Passive Event Listeners（https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#improving_scrolling_performance_with_passive_listeners）\n    // Passive Event Listeners 是一种优化技术，用于提高滚动性能。在默认情况下，浏览器会假设事件的监听器不会调用\n    // preventDefault() 方法来阻止事件的默认行为，从而允许进行一些优化操作，例如滚动平滑。\n    // 对于 Image 而言，如果使用触控板，双指朝不同方向分开放大图片，则需要  preventDefault 防止页面整体放大。\n    // Why register wheel event through addEventListener instead of using onWheel event？\n    // Because of Passive Event Listeners(an optimization technique used to improve scrolling performance. By default,\n    // the browser will assume that event listeners will not call preventDefault() method to prevent the default behavior of the event,\n    // allowing some optimization operations such as scroll smoothing.)\n    // For Image, if we use the trackpad and spread your fingers in different directions to enlarge the image, we need to preventDefault\n    // to prevent the page from being enlarged as a whole.\n    const registryImageWrapRef = (ref_): void => {\n      if (imageWrapRef.value) {\n        (imageWrapRef.value as any).removeEventListener('wheel', handleWheel);\n      }\n      if (ref_) {\n        ref_.addEventListener('wheel', handleWheel, { passive: false });\n      }\n      imageWrapRef.value = ref_;\n    };\n\n    return () => {\n      const {\n        getPopupContainer,\n        closable,\n        zIndex,\n        visible,\n        className,\n        style,\n        infinite,\n        zoomStep,\n        crossOrigin,\n        prevTip,\n        nextTip,\n        zoomInTip,\n        zoomOutTip,\n        rotateTip,\n        downloadTip,\n        adaptiveTip,\n        originTip,\n        showTooltip,\n        disableDownload,\n        renderPreviewMenu,\n        renderHeader,\n      } = props;\n      const { currentIndex, imgSrc, zoom, ratio, rotation, viewerVisible } = state;\n      let wrapperStyle: CSSProperties = {\n        zIndex,\n      };\n\n      if (getPopupContainer) {\n        wrapperStyle = {\n          zIndex,\n          position: 'static',\n        };\n      }\n      const previewPrefixCls = `${prefixCls}-preview`;\n      const previewWrapperCls = cls(\n        previewPrefixCls,\n        {\n          [`${prefixCls}-hide`]: !visible,\n          [`${previewPrefixCls}-popup`]: getPopupContainer,\n        },\n        className\n      );\n      const hideViewerCls = !viewerVisible ? `${previewPrefixCls}-hide` : '';\n      const total = imgSrc.length;\n      const showPrev = total !== 1 && (infinite || currentIndex !== 0);\n      const showNext = total !== 1 && (infinite || currentIndex !== total - 1);\n      return (\n        visible && (\n          <Portal getPopupContainer={getPopupContainer} style={wrapperStyle}>\n            {/* eslint-disable-next-line jsx-a11y/no-static-element-interactions */}\n            <div\n              class={previewWrapperCls}\n              style={style}\n              onMousedown={handleMouseDown}\n              onMouseup={handleMouseUp}\n              ref={registryImageWrapRef}\n              onMousemove={handleMouseMove}\n            >\n              <Header\n                ref={headerRef}\n                className={cls(hideViewerCls)}\n                onClose={handlePreviewClose}\n                renderHeader={renderHeader}\n                closable={closable}\n              />\n              <PreviewImage\n                ref={imageRef}\n                src={imgSrc[currentIndex]}\n                onZoom={handleZoomImage}\n                disableDownload={disableDownload}\n                setRatio={handleAdjustRatio}\n                zoom={zoom}\n                ratio={ratio}\n                rotation={rotation}\n                crossOrigin={crossOrigin}\n                onError={onImageError}\n                onLoad={onImageLoad}\n              />\n              {showPrev && (\n                // eslint-disable-next-line jsx-a11y/click-events-have-key-events,jsx-a11y/no-static-element-interactions\n                <div\n                  ref={leftIconRef}\n                  class={cls(`${previewPrefixCls}-icon`, `${previewPrefixCls}-prev`, hideViewerCls)}\n                  onClick={(): void => handleSwitchImage('prev')}\n                >\n                  <IconArrowLeft size=\"large\" />\n                </div>\n              )}\n              {showNext && (\n                // eslint-disable-next-line jsx-a11y/click-events-have-key-events,jsx-a11y/no-static-element-interactions\n                <div\n                  ref={rightIconRef}\n                  class={cls(`${previewPrefixCls}-icon`, `${previewPrefixCls}-next`, hideViewerCls)}\n                  onClick={(): void => handleSwitchImage('next')}\n                >\n                  <IconArrowRight size=\"large\" />\n                </div>\n              )}\n              <Footer\n                forwardRef={footerRef}\n                className={hideViewerCls}\n                totalNum={total}\n                curPage={currentIndex + 1}\n                disabledPrev={!showPrev}\n                disabledNext={!showNext}\n                zoom={zoom * 100}\n                step={zoomStep * 100}\n                showTooltip={showTooltip}\n                ratio={ratio}\n                prevTip={prevTip}\n                nextTip={nextTip}\n                zIndex={zIndex}\n                zoomInTip={zoomInTip}\n                zoomOutTip={zoomOutTip}\n                rotateTip={rotateTip}\n                downloadTip={downloadTip}\n                disableDownload={disableDownload}\n                adaptiveTip={adaptiveTip}\n                originTip={originTip}\n                onPrev={(): void => handleSwitchImage('prev')}\n                onNext={(): void => handleSwitchImage('next')}\n                onZoomIn={handleZoomImage}\n                onZoomOut={handleZoomImage}\n                onDownload={handleDownload}\n                onRotate={handleRotateImage}\n                onAdjustRatio={handleAdjustRatio}\n                renderPreviewMenu={renderPreviewMenu}\n              />\n            </div>\n          </Portal>\n        )\n      );\n    };\n  },\n});\n\nexport default PreviewInner;\n"],"names":["prefixCls","cssClasses","PREFIX","propTypes","style","PropTypes","object","className","string","lazyLoadMargin","visible","bool","src","oneOfType","array","currentIndex","number","defaultCurrentIndex","defaultVisible","maskClosable","closable","zoomStep","infinite","showTooltip","closeOnEsc","prevTip","nextTip","zoomInTip","zoomOutTip","downloadTip","adaptiveTip","originTip","lazyLoad","preLoad","preLoadGap","disableDownload","viewerVisibleDelay","zIndex","maxZoom","minZoom","renderHeader","func","renderPreviewMenu","getPopupContainer","onVisibleChange","onChange","onClose","onZoomIn","onZoomOut","onPrev","onNext","onDownload","onRatioChange","onRotateChange","setDownloadName","crossOrigin","previewTitle","node","rotateTip","onRotateLeft","onDownloadError","forwardRef","defaultProps","numbers","DEFAULT_Z_INDEX","vuePropsType","vuePropsMake","PreviewInner","defineComponent","props","name","setup","getProps","useHasInProps","useSlots","bodyOverflow","scrollBarWidth","originBodyWidth","imageRef","ref","state","reactive","imgSrc","imgLoadStatus","Map","zoom","ratio","rotation","viewerVisible","preloadAfterVisibleChange","direction","adapter","adapterInject","useBaseComponent","context","usePreviewContext","imageWrapRef","headerRef","footerRef","leftIconRef","rightIconRef","adapter_","getIsInGroup","isInGroup","disabledBodyScroll","document","body","overflow","width","enabledBodyScroll","notifyChange","index","isFunction","notifyZoom","increase","notifyClose","notifyVisibleChange","notifyRatioChange","type","notifyRotateChange","angle","notifyDownload","notifyDownloadError","registerKeyDownListener","window","addEventListener","handleKeyDown","unregisterKeyDownListener","removeEventListener","getSetDownloadFunc","value","isValidTarget","e","headerDom","footerDom","leftIconDom","rightIconDom","target","contains","changeImageZoom","args","foundation","changeZoom","PreviewInnerFoundation","getDerivedStateFromProps","willUpdateStates","Array","isArray","isEqual","watch","val","newState","Object","keys","forEach","key","deep","immediate","onMounted","getScrollbarWidth","beforeShow","prevStateVisible","prevPropsVisible","prevPropsSrc","onCleanup","updateTimer","afterHide","onBeforeUnmount","clearTimer","Boolean","isGroup","handleSwitchImage","handleDownload","handlePreviewClose","handleAdjustRatio","handleRotateImage","handleZoomImage","newZoom","notify","handleMouseUp","handleMouseMove","onImageError","preloadSingleImage","onImageLoad","handleMouseDown","handleWheel","registryImageWrapRef","ref_","passive","wrapperStyle","position","previewPrefixCls","previewWrapperCls","cls","hideViewerCls","total","length","showPrev","showNext","_createVNode","Portal","default","Header","PreviewImage","onClick","IconArrowLeft","IconArrowRight","Footer"],"mappings":"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"}