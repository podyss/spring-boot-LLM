{"version":3,"file":"notice.js","sources":["../../src/components/notification/notice.tsx"],"sourcesContent":["import cls from 'classnames';\nimport * as PropTypes from '../PropTypes';\nimport { cssClasses, numbers, strings } from '@douyinfe/semi-foundation/notification/constants';\nimport NotificationFoundation, {\n  NoticeAdapter,\n  NoticeProps,\n  NoticeState,\n} from '@douyinfe/semi-foundation/notification/notificationFoundation';\nimport Button from '../iconButton';\nimport { useBaseComponent } from '../_base/baseComponent';\nimport { isSemiIcon } from '../_utils';\nimport { noop } from 'lodash';\nimport { IconAlertCircle, IconAlertTriangle, IconClose, IconInfoCircle, IconTickCircle } from '@kousum/semi-icons-vue';\nimport { getUuidShort } from '@douyinfe/semi-foundation/utils/uuid';\nimport {\n  cloneVNode,\n  ComponentObjectPropsOptions,\n  CSSProperties,\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  PropType,\n  reactive,\n  useSlots,\n} from 'vue';\nimport { vuePropsMake } from '../PropTypes';\nimport { useConfigContext } from '../configProvider/context/Consumer';\nimport { CombineProps, VueJsxNode } from '../interface';\n\nexport interface NoticeReactProps extends NoticeProps {\n  style?: CSSProperties;\n  title?: VueJsxNode;\n  content?: VueJsxNode;\n  icon?: VueJsxNode;\n  onClick?: (e: MouseEvent) => void;\n}\n\nconst prefixCls = cssClasses.NOTICE;\nconst { duration } = numbers;\nconst { types, themes, directions } = strings;\n\nconst propTypes: CombineProps<NoticeReactProps> = {\n  duration: PropTypes.number,\n  id: PropTypes.string,\n  title: PropTypes.node,\n  content: PropTypes.node, // strings、numbers、array、element\n  type: String as PropType<NoticeReactProps['type']>,\n  theme: String as PropType<NoticeReactProps['theme']>,\n  icon: PropTypes.node,\n  onClick: PropTypes.func as PropType<NoticeReactProps['onClick']>,\n  onClose: PropTypes.func as PropType<NoticeReactProps['onClose']>,\n  onCloseClick: PropTypes.func as PropType<NoticeReactProps['onCloseClick']>,\n  showClose: PropTypes.bool,\n  // private props\n  close: PropTypes.func as PropType<NoticeReactProps['close']>,\n  direction: String as PropType<NoticeReactProps['direction']>,\n  onHookClose: PropTypes.func as PropType<NoticeReactProps['onHookClose']>,\n  style: PropTypes.object,\n  className: PropTypes.string,\n  position: PropTypes.string as PropType<NoticeReactProps['position']>,\n  zIndex: PropTypes.number,\n  getPopupContainer: PropTypes.func as PropType<NoticeReactProps['getPopupContainer']>,\n};\nconst defaultProps = {\n  duration,\n  id: '',\n  close: noop,\n  onClose: noop,\n  onClick: noop,\n  onCloseClick: noop,\n  content: '',\n  title: '',\n  showClose: true,\n  theme: 'normal',\n};\n\nexport const vuePropsType = vuePropsMake<NoticeReactProps>(propTypes, defaultProps);\nconst Notice = defineComponent({\n  props: { ...vuePropsType },\n  name: 'Notice',\n  setup(props, { expose }) {\n    const slots = useSlots();\n\n    const state = reactive<NoticeState>({\n      visible: true,\n    });\n\n    const { adapter: adapterInject } = useBaseComponent<NoticeReactProps>(props, state);\n    function adapter_(): NoticeAdapter {\n      return {\n        ...adapterInject(),\n        notifyWrapperToRemove: (id: string) => {\n          props.close(id);\n        },\n        notifyClose: () => {\n          props.onClose();\n          props.onHookClose && props.onHookClose();\n        },\n      };\n    }\n    const adapter = adapter_();\n    const foundation = new NotificationFoundation(adapter);\n\n    const { context } = useConfigContext();\n\n    onMounted(() => {\n      foundation.init();\n    });\n\n    onUnmounted(() => {\n      foundation.destroy();\n    });\n\n    function renderTypeIcon() {\n      const { type, icon } = props;\n      const iconMap = {\n        warning: <IconAlertTriangle size=\"large\" />,\n        success: <IconTickCircle size=\"large\" />,\n        info: <IconInfoCircle size=\"large\" />,\n        error: <IconAlertCircle size=\"large\" />,\n      };\n      let iconType = iconMap[type];\n      const iconCls = cls({\n        [`${prefixCls}-icon`]: true,\n        [`${prefixCls}-${type}`]: true,\n      });\n      if (icon) {\n        iconType = icon;\n      }\n      if (iconType) {\n        return (\n          <div class={iconCls} x-semi-prop=\"icon\">\n            {isSemiIcon(iconType) ? cloneVNode(iconType, { size: iconType.props?.size || 'large' }) : iconType}\n          </div>\n        );\n      }\n      return null;\n    }\n\n    const clearCloseTimer = () => {\n      foundation._clearCloseTimer();\n    };\n\n    const startCloseTimer = () => {\n      foundation._startCloseTimer();\n    };\n\n    const close = (e: MouseEvent) => {\n      props.onCloseClick(props.id);\n      foundation.close(e);\n    };\n\n    const notifyClick = (e: MouseEvent) => {\n      props.onClick(e);\n    };\n\n    expose({\n      getFoundation() {\n        return foundation;\n      },\n    });\n\n    return () => {\n      const direction = props.direction || context.value.direction;\n      const defaultPosition = direction === 'rtl' ? 'topLeft' : 'topRight';\n      const {\n        content,\n        title,\n        theme,\n        position = defaultPosition,\n        type,\n        id,\n        onCloseClick,\n        className,\n        showClose,\n        style,\n        ...attr\n      } = props;\n      const { visible } = state;\n      const wrapper = cls(prefixCls, className, {\n        [`${prefixCls}-close`]: !visible,\n        [`${prefixCls}-icon-show`]: types.includes(type),\n        [`${prefixCls}-${type}`]: true,\n        [`${prefixCls}-${theme}`]: theme === 'light',\n        [`${prefixCls}-rtl`]: direction === 'rtl',\n      });\n      const titleID = getUuidShort({});\n      return (\n        // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n        <div\n          class={wrapper}\n          style={style}\n          onMouseenter={clearCloseTimer}\n          onMouseleave={startCloseTimer}\n          onClick={notifyClick}\n          aria-labelledby={titleID}\n          role={'alert'}\n        >\n          <div>{renderTypeIcon()}</div>\n          <div class={`${prefixCls}-inner`}>\n            <div class={`${prefixCls}-content-wrapper`}>\n              {title ? (\n                <div id={titleID} class={`${prefixCls}-title`} x-semi-prop=\"title\">\n                  {title}\n                </div>\n              ) : (\n                ''\n              )}\n              {content ? (\n                <div class={`${prefixCls}-content`} x-semi-prop=\"content\">\n                  {content}\n                </div>\n              ) : (\n                ''\n              )}\n            </div>\n            {showClose && (\n              <Button\n                className={`${prefixCls}-icon-close`}\n                type=\"tertiary\"\n                icon={<IconClose />}\n                theme=\"borderless\"\n                size=\"small\"\n                onClick={close}\n              />\n            )}\n          </div>\n        </div>\n      );\n    };\n  },\n});\n\nexport default Notice;\n"],"names":["prefixCls","cssClasses","NOTICE","duration","numbers","types","themes","directions","strings","propTypes","PropTypes","number","id","string","title","node","content","type","String","theme","icon","onClick","func","onClose","onCloseClick","showClose","bool","close","direction","onHookClose","style","object","className","position","zIndex","getPopupContainer","defaultProps","noop","vuePropsType","vuePropsMake","Notice","defineComponent","props","name","setup","expose","useSlots","state","reactive","visible","adapter","adapterInject","useBaseComponent","adapter_","notifyWrapperToRemove","notifyClose","foundation","NotificationFoundation","context","useConfigContext","onMounted","init","onUnmounted","destroy","renderTypeIcon","iconType","warning","_createVNode","IconAlertTriangle","success","IconTickCircle","info","IconInfoCircle","error","IconAlertCircle","iconCls","cls","isSemiIcon","cloneVNode","size","clearCloseTimer","_clearCloseTimer","startCloseTimer","_startCloseTimer","e","notifyClick","getFoundation","value","defaultPosition","attr","wrapper","includes","titleID","getUuidShort","Button","IconClose"],"mappings":"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"}