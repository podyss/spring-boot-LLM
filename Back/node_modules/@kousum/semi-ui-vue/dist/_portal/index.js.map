{"version":3,"file":"index.js","sources":["../../src/components/_portal/index.tsx"],"sourcesContent":["import {\n  defineComponent,\n  ref,\n  h,\n  onActivated,\n  Fragment,\n  CSSProperties,\n  onBeforeMount,\n  onMounted,\n  watch,\n  onUnmounted,\n  Teleport,\n  reactive,\n  PropType,\n  onBeforeUnmount,\n} from 'vue';\nimport { BASE_CLASS_PREFIX } from '@douyinfe/semi-foundation/base/constants';\n\nimport classnames from 'classnames';\nimport '@douyinfe/semi-foundation/_portal/portal.scss';\nimport { useConfigContext } from '../configProvider/context/Consumer';\nimport type { ComponentObjectPropsOptions } from 'vue';\nimport { ContextValue } from '../configProvider/context';\nimport { CombineProps } from '../interface';\n\nexport interface PortalProps {\n  style?: CSSProperties;\n  prefixCls?: string;\n  className?: string;\n  getPopupContainer?: () => HTMLElement;\n  didUpdate?: (props: PortalProps) => void;\n}\n\nexport interface PortalState {\n  container: undefined | HTMLElement;\n}\n\nconst defaultGetContainer = () => document.body;\n\nexport const vuePropsType: CombineProps<PortalProps> = {\n  style: [Object, String] as PropType<PortalProps['style']>,\n  prefixCls: {\n    type: String,\n    default: `${BASE_CLASS_PREFIX}-portal`,\n  },\n  className: String,\n  getPopupContainer: Function as PropType<PortalProps['getPopupContainer']>,\n  didUpdate: Function as PropType<PortalProps['didUpdate']>,\n};\n\nconst Index = defineComponent({\n  props: { ...vuePropsType },\n  name: 'Portal',\n  setup(props, { slots }) {\n    const { context } = useConfigContext();\n    let el: HTMLElement;\n    const state = reactive({\n      container: undefined,\n    });\n    // onBeforeMount(()=>{\n    //   try {\n    //     el = initContainer(context.value, true);\n    //   } catch (e) {\n    //   }\n    // })\n\n    onMounted(() => {\n      const container = initContainer(context.value);\n      if (container !== state.container) {\n        state.container = container;\n      }\n    });\n    function initContainer(context: ContextValue, catchError = false) {\n      try {\n        let container: HTMLElement | undefined = undefined;\n        if (!el || !state.container || !Array.from(state.container.childNodes).includes(el)) {\n          el = document.createElement('div');\n          const getContainer = props.getPopupContainer || context.getPopupContainer || defaultGetContainer;\n          const portalContainer = getContainer();\n          portalContainer.appendChild(el);\n          addStyle(props.style);\n          addClass(props.prefixCls, context, props.className);\n          container = portalContainer;\n          return container;\n        }\n      } catch (e) {\n        if (!catchError) {\n          throw e;\n        }\n      }\n      return state?.container;\n    }\n\n    watch(\n      () => props,\n      (newProps, prevProps) => {\n        const { didUpdate } = props;\n        if (didUpdate) {\n          didUpdate(prevProps);\n        }\n      }\n    );\n\n    onUnmounted(() => {\n      if (state.container) {\n        state.container.removeChild(el);\n      }\n    });\n\n    const addStyle = (style: any = {}) => {\n      if (el) {\n        for (const key of Object.keys(style)) {\n          // @ts-ignore\n          el.style[key] = style[key];\n        }\n      }\n    };\n    const addClass = (prefixCls: string, context_ = context.value, ...classNames: string[]) => {\n      const { direction } = context_;\n      const cls = classnames(prefixCls, ...classNames, {\n        [`${prefixCls}-rtl`]: direction === 'rtl',\n      });\n      if (el) {\n        el.className = cls;\n      }\n    };\n\n    return () => {\n      if (state.container) {\n        return (\n          <Teleport to={el}>\n            {{\n              default: slots.default,\n            }}\n          </Teleport>\n        );\n      }\n      return null;\n    };\n  },\n});\n\nexport default Index;\n"],"names":["defaultGetContainer","document","body","vuePropsType","style","Object","String","prefixCls","type","default","BASE_CLASS_PREFIX","className","getPopupContainer","Function","didUpdate","Index","defineComponent","props","name","setup","slots","context","useConfigContext","el","state","reactive","container","undefined","onMounted","initContainer","value","catchError","Array","from","childNodes","includes","createElement","portalContainer","appendChild","addStyle","addClass","e","watch","newProps","prevProps","onUnmounted","removeChild","key","keys","context_","classNames","direction","cls","classnames","_createVNode","Teleport"],"mappings":";;;;;AAqCA,MAAMA,IAAsBA,MAAMC,SAASC,MAE9BC,IAA0C;AAAA,EACrDC,OAAO,CAACC,QAAQC,MAAM;AAAA,EACtBC,WAAW;AAAA,IACTC,MAAMF;AAAAA,IACNG,SAAS,GAAGC,CAAiB;AAAA,EAC9B;AAAA,EACDC,WAAWL;AAAAA,EACXM,mBAAmBC;AAAAA,EACnBC,WAAWD;AACb,GAEME,IAAQC,gBAAAA,EAAgB;AAAA,EAC5BC,OAAO;AAAA,IAAE,GAAGd;AAAAA,EAAc;AAAA,EAC1Be,MAAM;AAAA,EACNC,MAAMF,GAAO;AAAA,IAAEG,OAAAA;AAAAA,EAAM,GAAG;AACtB,UAAM;AAAA,MAAEC,SAAAA;AAAAA,IAAS,IAAGC,EAAgB;AACpC,QAAIC;AACJ,UAAMC,IAAQC,EAAS;AAAA,MACrBC,WAAWC;AAAAA,IACb,CAAC;AAQDC,IAAAA,EAAU,MAAM;AACd,YAAMF,IAAYG,EAAcR,EAAQS,KAAK;AAC7C,MAAIJ,MAAcF,EAAME,cACtBF,EAAME,YAAYA;AAAAA,IAEtB,CAAC;AACD,aAASG,EAAcR,GAAuBU,IAAa,IAAO;AAChE,UAAI;AACF,YAAIL;AACJ,YAAI,CAACH,KAAM,CAACC,EAAME,aAAa,CAACM,MAAMC,KAAKT,EAAME,UAAUQ,UAAU,EAAEC,SAASZ,CAAE,GAAG;AACnFA,UAAAA,IAAKtB,SAASmC,cAAc,KAAK;AAEjC,gBAAMC,KADepB,EAAML,qBAAqBS,EAAQT,qBAAqBZ;AAE7EqC,iBAAAA,EAAgBC,YAAYf,CAAE,GAC9BgB,EAAStB,EAAMb,KAAK,GACpBoC,EAASvB,EAAMV,WAAWc,GAASJ,EAAMN,SAAS,GAClDe,IAAYW,GACLX;AAAAA,QACT;AAAA,MACD,SAAQe,GAAG;AACV,YAAI,CAACV;AACH,gBAAMU;AAAAA,MAEV;AACA,aAAOjB,KAAAA,gBAAAA,EAAOE;AAAAA,IAChB;AAEAgB,IAAAA,EACE,MAAMzB,GACN,CAAC0B,GAAUC,MAAc;AACvB,YAAM;AAAA,QAAE9B,WAAAA;AAAAA,MAAW,IAAGG;AACtB,MAAIH,KACFA,EAAU8B,CAAS;AAAA,IAEvB,CACF,GAEAC,EAAY,MAAM;AAChB,MAAIrB,EAAME,aACRF,EAAME,UAAUoB,YAAYvB,CAAE;AAAA,IAElC,CAAC;AAED,UAAMgB,IAAWA,CAACnC,IAAa,OAAO;AACpC,UAAImB;AACF,mBAAWwB,KAAO1C,OAAO2C,KAAK5C,CAAK;AAEjCmB,UAAAA,EAAGnB,MAAM2C,CAAG,IAAI3C,EAAM2C,CAAG;AAAA,OAIzBP,IAAWA,CAACjC,GAAmB0C,IAAW5B,EAAQS,UAAUoB,MAAyB;AACzF,YAAM;AAAA,QAAEC,WAAAA;AAAAA,MAAW,IAAGF,GAChBG,IAAMC,EAAW9C,GAAW,GAAG2C,GAAY;AAAA,QAC/C,CAAC,GAAG3C,CAAS,MAAM,GAAG4C,MAAc;AAAA,MACtC,CAAC;AACD,MAAI5B,MACFA,EAAGZ,YAAYyC;AAAAA;AAInB,WAAO,MACD5B,EAAME,YACR4B,EAAAC,GAAA;AAAA,MAAA,IACgBhC;AAAAA,IAAE,GAAA;AAAA,MAEZd,SAASW,EAAMX;AAAAA,IAAO,CAAA,IAKvB;AAAA,EAEX;AACF,CAAC;"}