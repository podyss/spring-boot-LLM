{"version":3,"file":"copyable.js","sources":["../../src/components/typography/copyable.tsx"],"sourcesContent":["import {\n  cloneVNode,\n  ComponentObjectPropsOptions,\n  defineComponent,\n  h,\n  isVNode,\n  onUnmounted,\n  PropType,\n  reactive,\n  VNode,\n} from 'vue';\nimport Tooltip from '../tooltip';\nimport { cssClasses } from '@douyinfe/semi-foundation/typography/constants';\nimport copyModel from 'copy-text-to-clipboard';\nimport cls from 'classnames';\nimport { noop } from '@douyinfe/semi-foundation/utils/function';\nimport LocaleConsumer from '../locale/localeConsumer';\nimport { IconCopy, IconTick } from '@kousum/semi-icons-vue';\nimport { BaseProps } from '../_base/baseComponent';\nimport { Locale } from '../locale/interface';\nimport isEnterPress from '@douyinfe/semi-foundation/utils/isEnterPress';\nimport * as PropTypes from '../PropTypes';\nimport { CombineProps } from '../interface';\nimport { CopyableConfig } from './title';\n\nconst prefixCls = cssClasses.PREFIX;\nexport interface CopyableProps extends BaseProps {\n  content?: string;\n  copyTip?: any;\n  duration?: number;\n  forwardRef?: any;\n  successTip?: any;\n  icon?: VNode;\n  onCopy?: (e: any, content: string, res: boolean) => void;\n  render?: (copied: boolean, doCopy: (e: MouseEvent) => void, configs: CopyableConfig) => VNode\n\n}\ninterface CopyableState {\n  copied: boolean;\n  item: string;\n}\n\nexport const vuePropsType: CombineProps<CopyableProps> = {\n  forwardRef: Object,\n  content: {\n    type: String,\n    default: '',\n  },\n  onCopy: {\n    type: Function as PropType<CopyableProps['onCopy']>,\n    default: noop,\n  },\n  duration: {\n    type: Number,\n    default: 3,\n  },\n  style: {\n    type: [Object, String] as PropType<CopyableProps['style']>,\n    default: {},\n  },\n  className: {\n    type: String,\n    default: '',\n  },\n  copyTip: PropTypes.node,\n  successTip: PropTypes.node,\n  icon: PropTypes.node as PropType<CopyableProps['icon']>,\n  render: Function as PropType<CopyableProps['render']>,\n};\n\nconst Copyable = defineComponent({\n  props: { ...vuePropsType },\n  name: 'Copyable',\n  setup(props, { slots }) {\n    let _timeId: ReturnType<typeof setTimeout>;\n\n    const state = reactive({\n      copied: false,\n      item: '',\n    });\n\n    onUnmounted(() => {\n      if (_timeId) {\n        clearTimeout(_timeId);\n        _timeId = null;\n      }\n    });\n\n    const copy = (e: MouseEvent) => {\n      const { content, duration, onCopy } = props;\n      const res = copyModel(content);\n      onCopy && onCopy(e, content, res);\n      setCopied(content, duration);\n    };\n\n    const setCopied = (item: string, timer: number) => {\n      state.copied = true;\n      state.item = item;\n\n      _timeId = setTimeout(() => {\n        resetCopied();\n      }, timer * 1000);\n    };\n\n    const resetCopied = () => {\n      if (_timeId) {\n        clearTimeout(_timeId);\n        _timeId = null;\n        state.copied = false;\n        state.item = '';\n      }\n    };\n\n    const renderSuccessTip = () => {\n      const { successTip } = props;\n      if (typeof successTip !== 'undefined') {\n        return successTip;\n      }\n      return (\n        <LocaleConsumer componentName=\"Typography\">\n          {(locale: Locale['Typography']) => (\n            <span>\n              <IconTick />\n              {locale.copied}\n            </span>\n          )}\n        </LocaleConsumer>\n      );\n    };\n\n    const renderCopyIcon = () => {\n      const { icon } = props;\n      const copyProps = {\n        role: 'button',\n        tabIndex: 0,\n        onClick: copy,\n        onKeyPress: (e) => isEnterPress(e) && copy(e as any),\n      };\n\n      {\n        /* TODO: replace `a` tag with `span` in next major version\n            NOTE: may have effect on style */\n      }\n      const defaultIcon = (\n        // eslint-disable-next-line jsx-a11y/anchor-is-valid\n        <a class={`${prefixCls}-action-copy-icon`}>\n          <IconCopy onClick={copy} {...copyProps} />\n        </a>\n      );\n\n      return isVNode(icon) ? cloneVNode(icon, copyProps) : defaultIcon;\n    };\n    return () => {\n      const { style, className, forwardRef, copyTip, render } = props;\n      const { copied } = state;\n      const finalCls = cls(className, {\n        [`${prefixCls}-action-copy`]: !copied,\n        [`${prefixCls}-action-copied`]: copied,\n      });\n\n\n      if (render) {\n        return render(copied, copy, props);\n      }\n\n      return (\n        <LocaleConsumer componentName=\"Typography\">\n          {(locale: Locale['Typography']) => (\n            <span style={{ marginLeft: '4px', ...style }} class={finalCls} ref={forwardRef}>\n              {copied ? (\n                renderSuccessTip()\n              ) : (\n                <Tooltip content={typeof copyTip !== 'undefined' ? copyTip : locale.copy}>{renderCopyIcon()}</Tooltip>\n              )}\n            </span>\n          )}\n        </LocaleConsumer>\n      );\n    };\n  },\n});\n\nexport default Copyable;\n"],"names":["_isSlot","s","Object","prototype","toString","call","_isVNode","prefixCls","cssClasses","PREFIX","vuePropsType","forwardRef","content","type","String","default","onCopy","Function","noop","duration","Number","style","className","copyTip","PropTypes","node","successTip","icon","render","Copyable","defineComponent","props","name","setup","slots","_timeId","state","reactive","copied","item","onUnmounted","clearTimeout","copy","e","res","copyModel","setCopied","timer","setTimeout","resetCopied","renderSuccessTip","_createVNode","LocaleConsumer","locale","IconTick","renderCopyIcon","copyProps","role","tabIndex","onClick","onKeyPress","isEnterPress","defaultIcon","IconCopy","_mergeProps","isVNode","cloneVNode","finalCls","cls","_slot","marginLeft","Tooltip"],"mappings":"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"}