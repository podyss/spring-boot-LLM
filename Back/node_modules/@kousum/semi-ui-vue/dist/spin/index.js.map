{"version":3,"file":"index.js","sources":["../../src/components/spin/index.tsx"],"sourcesContent":["import {\n  defineComponent,\n  ref,\n  h,\n  StyleValue,\n  onUnmounted,\n  watch,\n  reactive,\n  ComponentObjectPropsOptions,\n  PropType,\n} from 'vue';\nimport cls from 'classnames';\nimport { cssClasses as css, strings } from '@douyinfe/semi-foundation/spin/constants';\nimport SpinFoundation from '@douyinfe/semi-foundation/spin/foundation';\nimport SpinIcon from './icon';\nimport '@douyinfe/semi-foundation/spin/spin.scss';\nimport { useBaseComponent, useHasInProps } from '../_base/baseComponent';\nimport { CombineProps } from '../interface';\n\nconst prefixCls = css.PREFIX;\n\nexport type SpinSize = 'small' | 'large' | 'middle';\n\nexport interface SpinProps {\n  size?: SpinSize;\n  spinning?: boolean;\n  indicator?: any | null;\n  delay?: number;\n  tip?: any;\n  wrapperClassName?: string;\n  style?: any;\n  childStyle?: StyleValue;\n}\n\ninterface SpinState {\n  delay: number;\n  loading: boolean;\n}\n\n/***\n *\n *         size: 'middle',\n *         spinning: true,\n *         children: null,\n *         indicator: null,\n *         delay: 0,\n */\nexport const VuePropsType: CombineProps<SpinProps> = {\n  size: {\n    type: String as PropType<SpinProps['size']>,\n    default: 'middle',\n  },\n  spinning: {\n    type: Boolean,\n    default: true,\n  },\n  indicator: Object,\n  delay: {\n    type: Number,\n    default: 0,\n  },\n  tip: [Object, String] as PropType<SpinProps['tip']>,\n  wrapperClassName: String,\n  style: Object,\n  childStyle: Object,\n};\nconst Index = defineComponent({\n  props: VuePropsType,\n  name: 'Spin',\n  setup(props, { slots }) {\n    const {getProps} = useHasInProps()\n    const state = reactive<SpinState>({\n      delay: props.delay,\n      loading: true,\n    });\n\n    // ok\n    function getDerivedStateFromProps(props: SpinProps) {\n      if (!props.delay) {\n        return {\n          loading: props.spinning,\n        };\n      }\n      if (props.spinning === false) {\n        return {\n          delay: 0,\n          loading: false,\n        };\n      }\n      return {\n        delay: props.delay,\n      };\n    }\n    watch(\n      () => props,\n      (val) => {\n        const newState = getDerivedStateFromProps({ ...getProps(props) });\n        if (newState) {\n          Object.keys(newState).forEach((key) => {\n            state[key] = newState[key];\n          });\n        }\n      },\n      { deep: true, immediate: true }\n    );\n\n    const { adapter: adapterInject, getDataAttr } = useBaseComponent<SpinProps>(props, state);\n    function adapter() {\n      return {\n        ...adapterInject<SpinProps, SpinState>(),\n        setLoading: (value: boolean) => {\n          state.loading = value;\n        },\n      };\n    }\n\n    const foundation = ref(new SpinFoundation(adapter()));\n\n    onUnmounted(() => {\n      foundation.value.destroy();\n    });\n    function renderSpin() {\n      const { indicator, tip } = props;\n      const { loading } = state;\n      const spinIconCls = cls({\n        [`${prefixCls}-animate`]: loading,\n      });\n\n      return state.loading ? (\n        <div class={`${prefixCls}-wrapper`}>\n          {indicator ? (\n            <div class={spinIconCls} x-semi-prop=\"indicator\">\n              {indicator}\n            </div>\n          ) : (\n            <SpinIcon />\n          )}\n          {tip ? <div x-semi-prop=\"tip\">{tip}</div> : null}\n        </div>\n      ) : null;\n    }\n\n    return () => {\n      foundation.value.updateLoadingIfNeedDelay();\n      const { style, wrapperClassName, childStyle, size, ...rest } = getProps(props);\n      const { loading } = state;\n      return (\n        <div\n          class={cls(prefixCls, wrapperClassName, {\n            [`${prefixCls}-${size}`]: size,\n            [`${prefixCls}-block`]: slots.default,\n            [`${prefixCls}-hidden`]: !loading,\n          })}\n          style={style}\n          {...getDataAttr()}\n        >\n          {renderSpin()}\n          <div class={`${prefixCls}-children`} style={childStyle} x-semi-prop=\"children\">\n            {slots.default ? slots.default() : null}\n          </div>\n        </div>\n      );\n    };\n  },\n});\n\nexport default Index;\n"],"names":["prefixCls","css","PREFIX","VuePropsType","size","type","String","default","spinning","Boolean","indicator","Object","delay","Number","tip","wrapperClassName","style","childStyle","Index","defineComponent","props","name","setup","slots","getProps","useHasInProps","state","reactive","loading","getDerivedStateFromProps","watch","val","newState","keys","forEach","key","deep","immediate","adapter","adapterInject","getDataAttr","useBaseComponent","setLoading","value","foundation","ref","SpinFoundation","onUnmounted","destroy","renderSpin","spinIconCls","cls","_createVNode","SpinIcon","updateLoadingIfNeedDelay","rest","_mergeProps"],"mappings":"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"}